<!DOCTYPE html>
<html>
<head>
  <title>docker.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../doc-style.css" />
  <script src="../doc-filelist.js"></script>
  <script>
    var relativeDir = "../", thisFile = "src/docker.js", defaultSidebar = true;
  </script>
  <script src="../doc-script.js"></script>
  <script src="../fileSearch.js"></script>
  <link rel="stylesheet" href="../fileSearch.css" />
</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">
      <div class="heading h1">
        <a href="#docker.js">docker.js</a>
      </div>
      <div class="heading h3">
        <a href="#a-simple-documentation-generator-based-on-docco">A simple documentation generator based on docco</a>
      </div>
      <div class="heading h2">
        <a href="#differences-from-docco">Differences from docco</a>
      </div>
      <div class="heading h2">
        <a href="#node-modules">Node Modules</a>
      </div>
      <div class="heading h2">
        <a href="#docker-constructor">Docker Constructor</a>
      </div>
      <div class="heading h2">
        <a href="#docker.prototype.parseopts">Docker.prototype.parseOpts</a>
      </div>
      <div class="heading h2">
        <a href="#docker.prototype.doc">Docker.prototype.doc</a>
      </div>
      <div class="heading h2">
        <a href="#docker.prototype.watch">Docker.prototype.watch</a>
      </div>
      <div class="heading h2">
        <a href="#docker.prototype.finished">Docker.prototype.finished</a>
      </div>
      <div class="heading h2">
        <a href="#docker.prototype.clean">Docker.prototype.clean</a>
      </div>
      <div class="heading h2">
        <a href="#docker.prototype.addnextfile">Docker.prototype.addNextFile</a>
      </div>
      <div class="heading h2">
        <a href="#docker.prototype.queuefile">Docker.prototype.queueFile</a>
      </div>
      <div class="heading h2">
        <a href="#docker.prototype.addfiletofree">Docker.prototype.addFileToFree</a>
      </div>
      <div class="heading h2">
        <a href="#docker.prototype.processnextfile">Docker.prototype.processNextFile</a>
      </div>
      <div class="heading h2">
        <a href="#docker.prototype.generatedoc">Docker.prototype.generateDoc</a>
      </div>
      <div class="heading h3">
        <a href="#this-is-where-the-magic-happens">This is where the magic happens</a>
      </div>
      <div class="heading h2">
        <a href="#docker.prototype.decidewhethertoprocess">Docker.prototype.decideWhetherToProcess</a>
      </div>
      <div class="heading h2">
        <a href="#docker.prototype.fileisnewer">Docker.prototype.fileIsNewer</a>
      </div>
      <div class="heading h2">
        <a href="#docker.prototype.parsesections">Docker.prototype.parseSections</a>
      </div>
      <div class="heading h2">
        <a href="#docker.prototype.parsemultline">Docker.prototype.parseMultline</a>
      </div>
      <div class="heading h2">
        <a href="#docker.prototype.outdent">Docker.prototype.outdent</a>
      </div>
      <div class="heading h2">
        <a href="#docker.prototype.languageparams">Docker.prototype.languageParams</a>
      </div>
      <div class="heading h2">
        <a href="#docker.prototype.pygments">Docker.prototype.pygments</a>
      </div>
      <div class="heading h2">
        <a href="#docker.prototype.highlight">Docker.prototype.highlight</a>
      </div>
      <div class="heading h2">
        <a href="#docker.prototype.processdoccodeblocks">Docker.prototype.processDocCodeBlocks</a>
      </div>
      <div class="heading h2">
        <a href="#docker.prototype.extractdoccode">Docker.prototype.extractDocCode</a>
      </div>
      <div class="heading h2">
        <a href="#docker.prototype.highlightextractedcode">Docker.prototype.highlightExtractedCode</a>
      </div>
      <div class="heading h2">
        <a href="#docker.prototype.addanchors">Docker.prototype.addAnchors</a>
      </div>
      <div class="heading h2">
        <a href="#docker.prototype.addlinenumbers">Docker.prototype.addLineNumbers</a>
      </div>
      <div class="heading h2">
        <a href="#docker.prototype.rendercodehtml">Docker.prototype.renderCodeHtml</a>
      </div>
      <div class="heading h2">
        <a href="#docker.prototype.rendermarkdownhtml">Docker.prototype.renderMarkdownHtml</a>
      </div>
      <div class="heading h2">
        <a href="#docker.prototype.copysharedresources">Docker.prototype.copySharedResources</a>
      </div>
      <div class="heading h2">
        <a href="#docker.prototype.copyextrafile">Docker.prototype.copyExtraFile</a>
      </div>
      <div class="heading h2">
        <a href="#docker.prototype.outfile">Docker.prototype.outFile</a>
      </div>
      <div class="heading h2">
        <a href="#docker.prototype.compiletemplate">Docker.prototype.compileTemplate</a>
      </div>
      <div class="heading h2">
        <a href="#docker.prototype.rendertemplate">Docker.prototype.renderTemplate</a>
      </div>
      <div class="heading h2">
        <a href="#docker.prototype.codefiletemplate">Docker.prototype.codeFileTemplate</a>
      </div>
      <div class="heading h2">
        <a href="#docker.prototype.jsdoctemplate">Docker.prototype.jsDocTemplate</a>
      </div>
      <div class="heading h2">
        <a href="#docker.prototype.writefile">Docker.prototype.writeFile</a>
      </div>
      <div class="heading h2">
        <a href="#docker.prototype.writefileifdifferent">Docker.prototype.writeFileIfDifferent</a>
      </div>
    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container"><div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
      <tr>
        <td class="docs">
<div class="pilwrap" id="docker.js">
  <h1>
    <a href="#docker.js" class="pilcrow">&#182;</a>
    docker.js
  </h1>
</div>



<div class="pilwrap" id="a-simple-documentation-generator-based-on-docco">
  <h3>
    <a href="#a-simple-documentation-generator-based-on-docco" class="pilcrow">&#182;</a>
    <em>A simple documentation generator based on <a href="http://jashkenas.github.com/docco/">docco</a></em>
  </h3>
</div>


<p><strong>Docker</strong> is a really simple documentation generator, which originally started out as a
pure-javascript port of <strong>docco</strong>, but which eventually gained many extra little features
which somewhat break docco's philosophy of being a quick-and-dirty thing.</p>

<p>Docker source-code can be found on <a href="https://github.com/jbt/docker">GitHub</a></p>

<p>Take a look at the <a href="http://jashkenas.github.com/docco/">original docco project</a> to get a feel
for the sort of functionality this provides. In short: <strong>Markdown</strong>-based displaying of code comments
next to syntax-highlighted code. This page is the result of running docker against itself.</p>

<p>The command-line usage of docker is somewhat more useful than that of docco. To use, simply run</p>


<div class="highlight"><pre><code>./docker -i path/to/code -o path/to/docs <span class="o">[</span>a_file.js a_dir<span class="o">]</span>
</code></pre></div>



<p>Docker will then recurse into the code root directory (or alternatively just the files
and directories you specify) and document-ize all the files it can.
The folder structure will be preserved in the document root.</p>

<p>More detailed usage instructions and examples can be found in the <a href="../README.md.html">README</a></p>


<div class="pilwrap" id="differences-from-docco">
  <h2>
    <a href="#differences-from-docco" class="pilcrow">&#182;</a>
    Differences from docco
  </h2>
</div>


<p>The main differences from docco are:</p>

<ul>
<li><p><strong>jsDoc support</strong>: support for <strong>jsDoc</strong>-style code comments, which
is provided in a style similar to <a href="https://github.com/visionmedia/dox">Dox</a>. You can see some examples of
the sort of output you get below.</p></li>
<li><p><strong>Folder Tree</strong> and <strong>Heading Navigation</strong>: collapsible sidebar with folder tree and jump-to
heading links for easy navigation between many files and within long files.</p></li>
<li><p><strong>Markdown File Support</strong>: support for plain markdown files, like the <a href="../README.md.html">README</a> for this project.</p></li>
<li><p><strong>Colour Schemes</strong>: support for multiple output colour schemes</p></li>
</ul>

<p>So let's get started!</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="node-modules">
  <h2>
    <a href="#node-modules" class="pilcrow">&#182;</a>
    Node Modules
  </h2>
</div>


<p>Include all the necessay node modules.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="kd">var</span> <span class="nx">mkdirp</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;mkdirp&#39;</span><span class="p">),</span>
  <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;fs&#39;</span><span class="p">),</span>
  <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;path&#39;</span><span class="p">),</span>
  <span class="nx">exec</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;child_process&#39;</span><span class="p">).</span><span class="nx">exec</span><span class="p">,</span>
  <span class="nx">spawn</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;child_process&#39;</span><span class="p">).</span><span class="nx">spawn</span><span class="p">,</span>
  <span class="nx">watchr</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;watchr&#39;</span><span class="p">),</span>
  <span class="nx">showdown</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;../lib/showdown&#39;</span><span class="p">).</span><span class="nx">Showdown</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3">&#182;</a>
</div>
<p>Polyfill <code>fs.exists</code> for node &lt;= 0.6</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="k">if</span><span class="p">(</span><span class="k">typeof</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">exists</span> <span class="o">!=</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">exists</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">exists</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="docker-constructor">
  <h2>
    <a href="#docker-constructor" class="pilcrow">&#182;</a>
    Docker Constructor
  </h2>
</div>

  </div>
  <div class="body"><p>Creates a new docker instance. All methods are called on one instance of this object.</p>

<p>Input arguments are either</p>

<ul>
<li>Object containing any of the keys <code>inDir</code>, <code>outDir</code>, <code>onlyUpdated</code>, <code>colourScheme</code>, <code>ignoreHidden</code>, <code>sidebarState</code>, <code>exclude</code></li>
<li>Or <code>indir</code>, <code>outDir</code>, <code>onlyUpdated</code>, <code>colourScheme</code> and <code>ignoreHidden</code> in order</li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="kd">var</span> <span class="nx">Docker</span> <span class="o">=</span> <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="cm">/* inDir, outDir, onlyUpdated, colourScheme, ignoreHidden */</span> <span class="p">){</span>
  <span class="k">if</span><span class="p">(</span><span class="k">typeof</span> <span class="nx">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;object&#39;</span><span class="p">){</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">parseOpts</span><span class="p">(</span><span class="nx">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
  <span class="p">}</span><span class="k">else</span><span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">parseOpts</span><span class="p">({</span>
      <span class="nx">inDir</span><span class="o">:</span> <span class="nx">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
      <span class="nx">outDir</span><span class="o">:</span> <span class="nx">arguments</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
      <span class="nx">onlyUpdated</span><span class="o">:</span> <span class="nx">arguments</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
      <span class="nx">colourScheme</span><span class="o">:</span> <span class="nx">arguments</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
      <span class="nx">ignoreHidden</span><span class="o">:</span> <span class="nx">arguments</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
    <span class="p">});</span>
  <span class="p">}</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">running</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">scanQueue</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">files</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">tree</span> <span class="o">=</span> <span class="p">{};</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="docker.prototype.parseopts">
  <h2>
    <a href="#docker.prototype.parseopts" class="pilcrow">&#182;</a>
    Docker.prototype.parseOpts
  </h2>
</div>

  </div>
  <div class="body"><p>Parses options for this docker instance</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">opts</span>
      <span class="dox_type">object</span>
      <span>Object containing all options fo rthis instance</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">Docker</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">parseOpts</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">opts</span><span class="p">){</span>
  <span class="kd">var</span> <span class="nx">defaults</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">inDir</span><span class="o">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">),</span>
    <span class="nx">outDir</span><span class="o">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="s1">&#39;doc&#39;</span><span class="p">),</span>
    <span class="nx">onlyUpdated</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nx">colourScheme</span><span class="o">:</span> <span class="s1">&#39;default&#39;</span><span class="p">,</span>
    <span class="nx">ignoreHidden</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nx">sidebarState</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nx">exclude</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nx">lineNums</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nx">js</span><span class="o">:</span> <span class="p">[],</span>
    <span class="nx">css</span><span class="o">:</span> <span class="p">[],</span>
    <span class="nx">extras</span><span class="o">:</span> <span class="p">[]</span>
  <span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6">&#182;</a>
</div>
<p>Loop through and fix up any unspecified options with the defaults.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">defaults</span><span class="p">){</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">defaults</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="nx">opts</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;undefined&#39;</span><span class="p">){</span>
      <span class="nx">opts</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">defaults</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">inDir</span> <span class="o">=</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">inDir</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\/$/</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">outDir</span> <span class="o">=</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">outDir</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">onlyUpdated</span> <span class="o">=</span> <span class="o">!!</span><span class="nx">opts</span><span class="p">.</span><span class="nx">onlyUpdated</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">colourScheme</span> <span class="o">=</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">colourScheme</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">ignoreHidden</span> <span class="o">=</span> <span class="o">!!</span><span class="nx">opts</span><span class="p">.</span><span class="nx">ignoreHidden</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">sidebarState</span> <span class="o">=</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">sidebarState</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">lineNums</span> <span class="o">=</span> <span class="o">!!</span><span class="nx">opts</span><span class="p">.</span><span class="nx">lineNums</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">extraJS</span> <span class="o">=</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">js</span> <span class="o">||</span> <span class="p">[];</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">extraCSS</span> <span class="o">=</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">css</span> <span class="o">||</span> <span class="p">[];</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7">&#182;</a>
</div>
<p>Generate an exclude regex for the given pattern</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">if</span><span class="p">(</span><span class="k">typeof</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">exclude</span> <span class="o">===</span> <span class="s1">&#39;string&#39;</span><span class="p">){</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">excludePattern</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s1">&#39;^(&#39;</span> <span class="o">+</span>
      <span class="nx">opts</span><span class="p">.</span><span class="nx">exclude</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\./g</span><span class="p">,</span><span class="s1">&#39;\\.&#39;</span><span class="p">)</span>
                  <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\*/g</span><span class="p">,</span> <span class="s1">&#39;.*&#39;</span><span class="p">)</span>
                  <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/,/g</span><span class="p">,</span> <span class="s1">&#39;|&#39;</span><span class="p">)</span> <span class="o">+</span>
      <span class="s1">&#39;)(/|$)&#39;</span><span class="p">);</span>
  <span class="p">}</span><span class="k">else</span><span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">excludePattern</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8">&#182;</a>
</div>
<p>Oh go on then. Allow American-Enligsh spelling of colour if used programmatically</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">if</span><span class="p">(</span><span class="nx">opts</span><span class="p">.</span><span class="nx">colorScheme</span><span class="p">)</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">colourScheme</span> <span class="o">=</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">colorScheme</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9">&#182;</a>
</div>
<p>Load bundled extras</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="kd">var</span> <span class="nx">extrasRoot</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="s1">&#39;extras&#39;</span><span class="p">);</span>
  <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">extras</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">){</span>
    <span class="kd">var</span> <span class="nx">extraName</span> <span class="o">=</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">extras</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">extraJS</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">extrasRoot</span><span class="p">,</span> <span class="nx">extraName</span><span class="p">,</span> <span class="nx">extraName</span> <span class="o">+</span> <span class="s1">&#39;.js&#39;</span><span class="p">));</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">extraCSS</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">extrasRoot</span><span class="p">,</span> <span class="nx">extraName</span><span class="p">,</span> <span class="nx">extraName</span> <span class="o">+</span> <span class="s1">&#39;.css&#39;</span><span class="p">));</span>
  <span class="p">}</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="docker.prototype.doc">
  <h2>
    <a href="#docker.prototype.doc" class="pilcrow">&#182;</a>
    Docker.prototype.doc
  </h2>
</div>

  </div>
  <div class="body"><p>Generate documentation for a bunch of files</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">files</span>
      <span class="dox_type">Array</span>
      <span>Array of file paths relative to the <code>inDir</code> to generate documentation for.</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">Docker</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">doc</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">files</span><span class="p">){</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">running</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">[].</span><span class="nx">push</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">scanQueue</span><span class="p">,</span> <span class="nx">files</span><span class="p">);</span>

  <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">onlyUpdated</span><span class="p">){</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11">&#182;</a>
</div>
<p>Attempt to grab the existing tree if possible.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">fs</span><span class="p">.</span><span class="nx">readFile</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">outDir</span><span class="p">,</span> <span class="s1">&#39;doc-filelist.js&#39;</span><span class="p">),</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">file</span><span class="p">){</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">addNextFile</span><span class="p">();</span>

      <span class="nx">file</span> <span class="o">=</span> <span class="nx">file</span><span class="p">.</span><span class="nx">toString</span><span class="p">().</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/(^var tree=|;$)/g</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
      <span class="nx">self</span><span class="p">.</span><span class="nx">tree</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">file</span><span class="p">);</span>

      <span class="nx">self</span><span class="p">.</span><span class="nx">addNextFile</span><span class="p">();</span>
    <span class="p">});</span>
  <span class="p">}</span><span class="k">else</span><span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">addNextFile</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="docker.prototype.watch">
  <h2>
    <a href="#docker.prototype.watch" class="pilcrow">&#182;</a>
    Docker.prototype.watch
  </h2>
</div>

  </div>
  <div class="body"><p>Watches the input directory for file changes and updates docs whenever a file is updated</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">files</span>
      <span class="dox_type">Array</span>
      <span>Array of file paths relative to the <code>inDir</code> to generate documentation for.</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">Docker</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">watch</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">files</span><span class="p">){</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">watching</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">watchFiles</span> <span class="o">=</span> <span class="nx">files</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-13" id="section-13">&#182;</a>
</div>
<p>Function to call when a file is changed. We put this on a timeout to account
for several file changes happening in quick succession.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="kd">var</span> <span class="nx">uto</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
  <span class="kd">function</span> <span class="nx">update</span><span class="p">(){</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">running</span><span class="p">)</span> <span class="k">return</span> <span class="p">(</span><span class="nx">uto</span> <span class="o">=</span> <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">update</span><span class="p">,</span> <span class="mi">250</span><span class="p">));</span>
    <span class="nx">self</span><span class="p">.</span><span class="nx">clean</span><span class="p">();</span>
    <span class="nx">self</span><span class="p">.</span><span class="nx">doc</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">watchFiles</span><span class="p">);</span>
    <span class="nx">uto</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-14" id="section-14">&#182;</a>
</div>
<p>Install watchr. The <code>null</code> here is a watchr bug - looks like he forgot to allow for exactly
two arguments (like in his example)</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nx">watchr</span><span class="p">.</span><span class="nx">watch</span><span class="p">({</span>
    <span class="nx">path</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">inDir</span><span class="p">,</span>
    <span class="nx">listener</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
      <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">uto</span><span class="p">)</span> <span class="nx">uto</span> <span class="o">=</span> <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">update</span><span class="p">,</span> <span class="mi">250</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">});</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-15" id="section-15">&#182;</a>
</div>
<p>Aaaaand, go!</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">this</span><span class="p">.</span><span class="nx">doc</span><span class="p">(</span><span class="nx">files</span><span class="p">);</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="docker.prototype.finished">
  <h2>
    <a href="#docker.prototype.finished" class="pilcrow">&#182;</a>
    Docker.prototype.finished
  </h2>
</div>

  </div>
  <div class="body"><p>Callback function fired when processing is finished.</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">Docker</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">finished</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">running</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">watching</span><span class="p">){</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-17" id="section-17">&#182;</a>
</div>
<p>If we're in watch mode, switch "only updated files" mode on if it isn't already</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">this</span><span class="p">.</span><span class="nx">onlyUpdated</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Done. Waiting for changes...&#39;</span><span class="p">);</span>
  <span class="p">}</span><span class="k">else</span><span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Done.&#39;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="docker.prototype.clean">
  <h2>
    <a href="#docker.prototype.clean" class="pilcrow">&#182;</a>
    Docker.prototype.clean
  </h2>
</div>

  </div>
  <div class="body"><p>Clears out any instance variables so this docker can be rerun</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">Docker</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">clean</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">scanQueue</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">files</span> <span class="o">=</span> <span class="p">[];</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="docker.prototype.addnextfile">
  <h2>
    <a href="#docker.prototype.addnextfile" class="pilcrow">&#182;</a>
    Docker.prototype.addNextFile
  </h2>
</div>

  </div>
  <div class="body"><p>Process the next file on the scan queue. If it's a directory, list all the children and queue those.
If it's a file, add it to the queue.</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">Docker</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">addNextFile</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
  <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">scanQueue</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">){</span>
    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">,</span> <span class="nx">filename</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">scanQueue</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>
    <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">excludePattern</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">excludePattern</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">filename</span><span class="p">)){</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">addNextFile</span><span class="p">();</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">var</span> <span class="nx">currFile</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">inDir</span><span class="p">,</span> <span class="nx">filename</span><span class="p">);</span>
    <span class="nx">fs</span><span class="p">.</span><span class="nx">lstat</span><span class="p">(</span><span class="nx">currFile</span><span class="p">,</span> <span class="kd">function</span> <span class="nx">cb</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">stat</span><span class="p">){</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">err</span><span class="p">){</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-20" id="section-20">&#182;</a>
</div>
<p>Something unexpected happened on the filesystem.
Nothing really that we can do about it, so throw it and be done with it</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="k">throw</span> <span class="nx">err</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="k">if</span><span class="p">(</span><span class="nx">stat</span> <span class="o">&amp;&amp;</span> <span class="nx">stat</span><span class="p">.</span><span class="nx">isSymbolicLink</span><span class="p">()){</span>
        <span class="nx">fs</span><span class="p">.</span><span class="nx">readlink</span><span class="p">(</span><span class="nx">currFile</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">link</span><span class="p">){</span>
          <span class="k">if</span><span class="p">(</span><span class="nx">err</span><span class="p">){</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-21" id="section-21">&#182;</a>
</div>
<p>Something unexpected happened on the filesystem.
Nothing really that we can do about it, so throw it and be done with it</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
            <span class="k">throw</span> <span class="nx">err</span><span class="p">;</span>
          <span class="p">}</span>
          <span class="nx">currFile</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">dirname</span><span class="p">(</span><span class="nx">currFile</span><span class="p">),</span> <span class="nx">link</span><span class="p">);</span>
          <span class="nx">fs</span><span class="p">.</span><span class="nx">exists</span><span class="p">(</span><span class="nx">currFile</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">exists</span><span class="p">){</span>
            <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">exists</span><span class="p">){</span>
              <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;Unable to follow symlink to &quot;</span> <span class="o">+</span> <span class="nx">currFile</span> <span class="o">+</span> <span class="s1">&#39;: file does not exist&#39;</span><span class="p">);</span>
              <span class="nx">self</span><span class="p">.</span><span class="nx">addNextFile</span><span class="p">();</span>
            <span class="p">}</span><span class="k">else</span><span class="p">{</span>
              <span class="nx">fs</span><span class="p">.</span><span class="nx">lstat</span><span class="p">(</span><span class="nx">currFile</span><span class="p">,</span> <span class="nx">cb</span><span class="p">);</span>
            <span class="p">}</span>
          <span class="p">});</span>
        <span class="p">});</span>
      <span class="p">}</span><span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">stat</span> <span class="o">&amp;&amp;</span> <span class="nx">stat</span><span class="p">.</span><span class="nx">isDirectory</span><span class="p">()){</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-22" id="section-22">&#182;</a>
</div>
<p>Find all children of the directory and queue those</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nx">fs</span><span class="p">.</span><span class="nx">readdir</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">inDir</span><span class="p">,</span> <span class="nx">filename</span><span class="p">),</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">list</span><span class="p">){</span>
           <span class="k">if</span><span class="p">(</span><span class="nx">err</span><span class="p">){</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-23" id="section-23">&#182;</a>
</div>
<p>Something unexpected happened on the filesystem.
Nothing really that we can do about it, so throw it and be done with it</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
            <span class="k">throw</span> <span class="nx">err</span><span class="p">;</span>
          <span class="p">}</span>
          <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">list</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">){</span>
            <span class="k">if</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">ignoreHidden</span> <span class="o">&amp;&amp;</span> <span class="nx">list</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nx">match</span><span class="p">(</span><span class="sr">/[\._]/</span><span class="p">))</span> <span class="k">continue</span><span class="p">;</span>
            <span class="nx">self</span><span class="p">.</span><span class="nx">scanQueue</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">filename</span><span class="p">,</span> <span class="nx">list</span><span class="p">[</span><span class="nx">i</span><span class="p">]));</span>
          <span class="p">}</span>
          <span class="nx">self</span><span class="p">.</span><span class="nx">addNextFile</span><span class="p">();</span>
        <span class="p">});</span>
      <span class="p">}</span><span class="k">else</span><span class="p">{</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">queueFile</span><span class="p">(</span><span class="nx">filename</span><span class="p">);</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">addNextFile</span><span class="p">();</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="p">}</span><span class="k">else</span><span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-24" id="section-24">&#182;</a>
</div>
<p>Once we're done scanning all the files, start processing them in order.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">this</span><span class="p">.</span><span class="nx">files</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">files</span><span class="p">.</span><span class="nx">sort</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">processNextFile</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="docker.prototype.queuefile">
  <h2>
    <a href="#docker.prototype.queuefile" class="pilcrow">&#182;</a>
    Docker.prototype.queueFile
  </h2>
</div>

  </div>
  <div class="body"><p>Queues a file for processing, and additionally stores it in the folder tree</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">filename</span>
      <span class="dox_type">string</span>
      <span>Name of the file to queue</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">Docker</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">queueFile</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">filename</span><span class="p">){</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">files</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">filename</span><span class="p">);</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="docker.prototype.addfiletofree">
  <h2>
    <a href="#docker.prototype.addfiletofree" class="pilcrow">&#182;</a>
    Docker.prototype.addFileToFree
  </h2>
</div>

  </div>
  <div class="body"><p>Adds a file to the file tree to show in the sidebar. This used to be in <code>queueFile</code> but
since we're now only deciding whether or not the file can be included at the point of
reading it, this has to happen later.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">filename</span>
      <span class="dox_type">string</span>
      <span>Name of file to add to the tree</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">Docker</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">addFileToTree</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">filename</span><span class="p">){</span>
  <span class="kd">var</span> <span class="nx">pathSeparator</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/(^.*a|b.*$)/g</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-27" id="section-27">&#182;</a>
</div>
<p>Split the file's path into the individual directories</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nx">filename</span> <span class="o">=</span> <span class="nx">filename</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s1">&#39;^&#39;</span> <span class="o">+</span> <span class="nx">pathSeparator</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/([\/\\])/g</span><span class="p">,</span> <span class="s1">&#39;\\$1&#39;</span><span class="p">)),</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">bits</span> <span class="o">=</span> <span class="nx">filename</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="nx">pathSeparator</span><span class="p">);</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-28" id="section-28">&#182;</a>
</div>
<p>Loop through all the directories and process the folder structure into <code>this.tree</code>.</p>

<p><code>this.tree</code> takes the format:</p>


<div class="highlight"><pre><code> <span class="p">{</span>
   <span class="nx">dirs</span><span class="o">:</span> <span class="p">{</span>
     <span class="s1">&#39;child_dir_name&#39;</span><span class="o">:</span> <span class="p">{</span> <span class="cm">/* same format as tree */</span> <span class="p">},</span>
     <span class="s1">&#39;other_child_name&#39;</span><span class="o">:</span> <span class="c1">// etc...</span>
   <span class="p">},</span>
   <span class="nx">files</span><span class="o">:</span> <span class="p">[</span>
     <span class="s1">&#39;filename.js&#39;</span><span class="p">,</span>
     <span class="s1">&#39;filename2.js&#39;</span><span class="p">,</span>
     <span class="c1">// etc...</span>
   <span class="p">]</span>
 <span class="p">}</span>
</code></pre></div>


        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="kd">var</span> <span class="nx">currDir</span>  <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tree</span><span class="p">;</span>
  <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">bits</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">){</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">currDir</span><span class="p">.</span><span class="nx">dirs</span><span class="p">)</span> <span class="nx">currDir</span><span class="p">.</span><span class="nx">dirs</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">currDir</span><span class="p">.</span><span class="nx">dirs</span><span class="p">[</span><span class="nx">bits</span><span class="p">[</span><span class="nx">i</span><span class="p">]])</span><span class="nx">currDir</span><span class="p">.</span><span class="nx">dirs</span><span class="p">[</span><span class="nx">bits</span><span class="p">[</span><span class="nx">i</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="nx">currDir</span> <span class="o">=</span> <span class="nx">currDir</span><span class="p">.</span><span class="nx">dirs</span><span class="p">[</span><span class="nx">bits</span><span class="p">[</span><span class="nx">i</span><span class="p">]];</span>
  <span class="p">}</span>
  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">currDir</span><span class="p">.</span><span class="nx">files</span><span class="p">)</span> <span class="nx">currDir</span><span class="p">.</span><span class="nx">files</span> <span class="o">=</span> <span class="p">[];</span>

  <span class="kd">var</span> <span class="nx">lastBit</span> <span class="o">=</span> <span class="nx">bits</span><span class="p">[</span><span class="nx">bits</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">];</span>

  <span class="k">if</span><span class="p">(</span><span class="nx">currDir</span><span class="p">.</span><span class="nx">files</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">lastBit</span><span class="p">)</span> <span class="o">===</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="nx">currDir</span><span class="p">.</span><span class="nx">files</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">bits</span><span class="p">[</span><span class="nx">bits</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">]);</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="docker.prototype.processnextfile">
  <h2>
    <a href="#docker.prototype.processnextfile" class="pilcrow">&#182;</a>
    Docker.prototype.processNextFile
  </h2>
</div>

  </div>
  <div class="body"><p>Take the next file off the queue and process it</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">Docker</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">processNextFile</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
  <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-30" id="section-30">&#182;</a>
</div>
<p>If we still have files on the queue, process the first one</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">files</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">){</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">generateDoc</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">files</span><span class="p">.</span><span class="nx">shift</span><span class="p">(),</span> <span class="kd">function</span><span class="p">(){</span>
      <span class="nx">self</span><span class="p">.</span><span class="nx">processNextFile</span><span class="p">();</span>
    <span class="p">});</span>
  <span class="p">}</span><span class="k">else</span><span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">copySharedResources</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="docker.prototype.generatedoc">
  <h2>
    <a href="#docker.prototype.generatedoc" class="pilcrow">&#182;</a>
    Docker.prototype.generateDoc
  </h2>
</div>



<div class="pilwrap" id="this-is-where-the-magic-happens">
  <h3>
    <a href="#this-is-where-the-magic-happens" class="pilcrow">&#182;</a>
    <em>This is where the magic happens</em>
  </h3>
</div>

  </div>
  <div class="body"><p>Generate the documentation for a file</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">filename</span>
      <span class="dox_type">string</span>
      <span>File name to generate documentation for</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">cb</span>
      <span class="dox_type">function</span>
      <span>Callback function to execute when we're done</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">Docker</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">generateDoc</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">infilename</span><span class="p">,</span> <span class="nx">cb</span><span class="p">){</span>
  <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">running</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
  <span class="nx">filename</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">inDir</span><span class="p">,</span> <span class="nx">infilename</span><span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">decideWhetherToProcess</span><span class="p">(</span><span class="nx">filename</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">shouldProcess</span><span class="p">){</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">shouldProcess</span><span class="p">)</span> <span class="k">return</span> <span class="nx">cb</span><span class="p">();</span>
    <span class="nx">fs</span><span class="p">.</span><span class="nx">readFile</span><span class="p">(</span><span class="nx">filename</span><span class="p">,</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">data</span><span class="p">){</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="k">throw</span> <span class="nx">err</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">lang</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">languageParams</span><span class="p">(</span><span class="nx">filename</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">lang</span> <span class="o">===</span> <span class="kc">false</span><span class="p">)</span> <span class="k">return</span> <span class="nx">cb</span><span class="p">();</span>
      <span class="nx">self</span><span class="p">.</span><span class="nx">addFileToTree</span><span class="p">(</span><span class="nx">infilename</span><span class="p">);</span>
      <span class="k">switch</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">languages</span><span class="p">[</span><span class="nx">lang</span><span class="p">].</span><span class="nx">type</span><span class="p">){</span>
        <span class="k">case</span> <span class="s1">&#39;markdown&#39;</span><span class="o">:</span>
          <span class="nx">self</span><span class="p">.</span><span class="nx">renderMarkdownHtml</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">filename</span><span class="p">,</span> <span class="nx">cb</span><span class="p">);</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="k">default</span><span class="o">:</span>
        <span class="k">case</span> <span class="s1">&#39;code&#39;</span><span class="o">:</span>
          <span class="kd">var</span> <span class="nx">sections</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">parseSections</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">lang</span><span class="p">);</span>
          <span class="nx">self</span><span class="p">.</span><span class="nx">highlight</span><span class="p">(</span><span class="nx">sections</span><span class="p">,</span> <span class="nx">lang</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
            <span class="nx">self</span><span class="p">.</span><span class="nx">renderCodeHtml</span><span class="p">(</span><span class="nx">sections</span><span class="p">,</span> <span class="nx">filename</span><span class="p">,</span> <span class="nx">cb</span><span class="p">);</span>
          <span class="p">});</span>
          <span class="k">break</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="p">});</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="docker.prototype.decidewhethertoprocess">
  <h2>
    <a href="#docker.prototype.decidewhethertoprocess" class="pilcrow">&#182;</a>
    Docker.prototype.decideWhetherToProcess
  </h2>
</div>

  </div>
  <div class="body"><p>Decide whether or not a file should be processed. If the <code>onlyUpdated</code>
flag was set on initialization, only allow processing of files that
are newer than their counterpart generated doc file.</p>

<p>Fires a callback function with either true or false depending on whether
or not the file should be processed</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">filename</span>
      <span class="dox_type">string</span>
      <span>The name of the file to check</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">callback</span>
      <span class="dox_type">function</span>
      <span>Callback function</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">Docker</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">decideWhetherToProcess</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">filename</span><span class="p">,</span> <span class="nx">callback</span><span class="p">){</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-33" id="section-33">&#182;</a>
</div>
<p>If we should be processing all files, then yes, we should process this one</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">onlyUpdated</span><span class="p">)</span> <span class="k">return</span> <span class="nx">callback</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-34" id="section-34">&#182;</a>
</div>
<p>Find the doc this file would be compiled to</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="kd">var</span> <span class="nx">outFile</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">outFile</span><span class="p">(</span><span class="nx">filename</span><span class="p">);</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-35" id="section-35">&#182;</a>
</div>
<p>See whether the file is newer than the output</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">this</span><span class="p">.</span><span class="nx">fileIsNewer</span><span class="p">(</span><span class="nx">filename</span><span class="p">,</span> <span class="nx">outFile</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="docker.prototype.fileisnewer">
  <h2>
    <a href="#docker.prototype.fileisnewer" class="pilcrow">&#182;</a>
    Docker.prototype.fileIsNewer
  </h2>
</div>

  </div>
  <div class="body"><p>Sees whether one file is newer than another</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">file</span>
      <span class="dox_type">string</span>
      <span>File to check</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">otherFile</span>
      <span class="dox_type">string</span>
      <span>File to compare to</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">callback</span>
      <span class="dox_type">function</span>
      <span>Callback to fire with true if file is newer than otherFile</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">Docker</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">fileIsNewer</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">file</span><span class="p">,</span> <span class="nx">otherFile</span><span class="p">,</span> <span class="nx">callback</span><span class="p">){</span>
  <span class="nx">fs</span><span class="p">.</span><span class="nx">stat</span><span class="p">(</span><span class="nx">otherFile</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">outStat</span><span class="p">){</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-37" id="section-37">&#182;</a>
</div>
<p>If the output file doesn't exist, then definitely process this file</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">if</span><span class="p">(</span><span class="nx">err</span> <span class="o">&amp;&amp;</span> <span class="nx">err</span><span class="p">.</span><span class="nx">code</span> <span class="o">==</span> <span class="s1">&#39;ENOENT&#39;</span><span class="p">)</span> <span class="k">return</span> <span class="nx">callback</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>

    <span class="nx">fs</span><span class="p">.</span><span class="nx">stat</span><span class="p">(</span><span class="nx">file</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">inStat</span><span class="p">){</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-38" id="section-38">&#182;</a>
</div>
<p>Process the file if the input is newer than the output</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nx">callback</span><span class="p">(</span><span class="o">+</span><span class="nx">inStat</span><span class="p">.</span><span class="nx">mtime</span> <span class="o">&gt;</span> <span class="o">+</span><span class="nx">outStat</span><span class="p">.</span><span class="nx">mtime</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">});</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="docker.prototype.parsesections">
  <h2>
    <a href="#docker.prototype.parsesections" class="pilcrow">&#182;</a>
    Docker.prototype.parseSections
  </h2>
</div>

  </div>
  <div class="body"><p>Parse the content of a file into individual sections.
A section is defined to be one block of code with an accompanying comment</p>

<p>Returns an array of section objects, which take the form</p>


<div class="highlight"><pre><code> <span class="p">{</span>
   <span class="nx">doc_text</span><span class="o">:</span> <span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="c1">// String containing comment content</span>
   <span class="nx">code_text</span><span class="o">:</span> <span class="s1">&#39;bar&#39;</span> <span class="c1">// Accompanying code</span>
 <span class="p">}</span>
</code></pre></div>


  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">data</span>
      <span class="dox_type">string</span>
      <span>The contents of the script file</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">language</span>
      <span class="dox_type">string</span>
      <span>The language of the script file</span>
    </div>
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">Array</span>
      <span>array of section objects</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">Docker</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">parseSections</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">language</span><span class="p">){</span>
  <span class="kd">var</span> <span class="nx">codeLines</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;\n&#39;</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">sections</span> <span class="o">=</span> <span class="p">[];</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-40" id="section-40">&#182;</a>
</div>
<p>Fetch language-specific parameters for this code file</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="kd">var</span> <span class="nx">params</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">languages</span><span class="p">[</span><span class="nx">language</span><span class="p">];</span>
  <span class="kd">var</span> <span class="nx">section</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">docs</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="nx">code</span><span class="o">:</span> <span class="s1">&#39;&#39;</span>
  <span class="p">};</span>
  <span class="kd">var</span> <span class="nx">inMultiLineComment</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">multiLine</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">jsDocData</span><span class="p">;</span>

  <span class="kd">function</span> <span class="nx">md</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">stripParas</span><span class="p">){</span>
    <span class="kd">var</span> <span class="nx">h</span> <span class="o">=</span> <span class="nx">showdown</span><span class="p">.</span><span class="nx">makeHtml</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/(^\s*|\s*$)/</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">));</span>
    <span class="k">return</span> <span class="nx">stripParas</span> <span class="o">?</span> <span class="nx">h</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&lt;\/?p&gt;/g</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">:</span> <span class="nx">h</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">var</span> <span class="nx">commentRegex</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s1">&#39;^\\s*&#39;</span> <span class="o">+</span> <span class="nx">params</span><span class="p">.</span><span class="nx">comment</span> <span class="o">+</span> <span class="s1">&#39;\\s?&#39;</span><span class="p">);</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-41" id="section-41">&#182;</a>
</div>
<p>Loop through all the lines, and parse into sections</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">codeLines</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">){</span>
    <span class="kd">var</span> <span class="nx">line</span> <span class="o">=</span> <span class="nx">codeLines</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-42" id="section-42">&#182;</a>
</div>
<p>Only match against parts of the line that don't appear in strings</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="kd">var</span> <span class="nx">matchable</span> <span class="o">=</span> <span class="nx">line</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/([&quot;&#39;])((?:[^\\\1]|(?:\\\\)*?\\[^\\])*?)\1/g</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">);</span>

    <span class="k">if</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">multiLine</span><span class="p">){</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-43" id="section-43">&#182;</a>
</div>
<p>If we are currently in a multiline comment, behave differently</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">if</span><span class="p">(</span><span class="nx">inMultiLineComment</span><span class="p">){</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-44" id="section-44">&#182;</a>
</div>
<p>End-multiline comments should match regardless of whether they're 'quoted'</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="k">if</span><span class="p">(</span><span class="nx">line</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">multiLine</span><span class="p">[</span><span class="mi">1</span><span class="p">])){</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-45" id="section-45">&#182;</a>
</div>
<p>Once we have reached the end of the multiline, take the whole content
of the multiline comment, and parse it as jsDoc.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
          <span class="nx">inMultiLineComment</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

          <span class="nx">multiLine</span> <span class="o">+=</span> <span class="nx">line</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-46" id="section-46">&#182;</a>
</div>
<p>Replace block comment delimiters with whitespace of the same length
This way we can safely outdent without breaking too many things if the
comment has been deliberately indented. For example, the lines in the
followinc comment should all be outdented equally:</p>


<div class="highlight"><pre><code>   <span class="cm">/* A big long multiline</span>
<span class="cm">      comment that should get</span>
<span class="cm">      outdented properly       */</span>
</code></pre></div>


        </td>
        <td class="code highlight"><div class="highlight"><pre>
          <span class="nx">multiLine</span> <span class="o">=</span> <span class="nx">multiLine</span>
            <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">multiLine</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">){</span> <span class="k">return</span> <span class="nb">Array</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">length</span> <span class="o">+</span> <span class="mi">1</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">);</span> <span class="p">})</span>
            <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">multiLine</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">){</span> <span class="k">return</span> <span class="nb">Array</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">length</span> <span class="o">+</span> <span class="mi">1</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">);</span> <span class="p">});</span>

          <span class="nx">multiLine</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">outdent</span><span class="p">(</span><span class="nx">multiLine</span><span class="p">);</span>

          <span class="k">if</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">jsDoc</span><span class="p">){</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-47" id="section-47">&#182;</a>
</div>
<p>Strip off leading * characters.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
            <span class="nx">multiLine</span> <span class="o">=</span> <span class="nx">multiLine</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^[ \t]*\*? ?/gm</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">);</span>

            <span class="nx">jsDocData</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">parseMultiline</span><span class="p">(</span><span class="nx">multiLine</span><span class="p">);</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-48" id="section-48">&#182;</a>
</div>
<p>Put markdown parser on the data so it can be accessed in the template</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
            <span class="nx">jsDocData</span><span class="p">.</span><span class="nx">md</span> <span class="o">=</span> <span class="nx">md</span><span class="p">;</span>
            <span class="nx">section</span><span class="p">.</span><span class="nx">docs</span> <span class="o">+=</span> <span class="k">this</span><span class="p">.</span><span class="nx">jsDocTemplate</span><span class="p">(</span><span class="nx">jsDocData</span><span class="p">);</span>
          <span class="p">}</span><span class="k">else</span><span class="p">{</span>
            <span class="nx">section</span><span class="p">.</span><span class="nx">docs</span> <span class="o">+=</span> <span class="s1">&#39;\n&#39;</span> <span class="o">+</span> <span class="nx">multiLine</span> <span class="o">+</span> <span class="s1">&#39;\n&#39;</span><span class="p">;</span>
          <span class="p">}</span>
          <span class="nx">multiLine</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
          <span class="nx">multiLine</span> <span class="o">+=</span> <span class="nx">line</span> <span class="o">+</span> <span class="s1">&#39;\n&#39;</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">continue</span><span class="p">;</span>
      <span class="p">}</span><span class="k">else</span> <span class="k">if</span><span class="p">(</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-49" id="section-49">&#182;</a>
</div>
<p>We want to match the start of a multiline comment only if the line doesn't also match the
end of the same comment, or if a single-line comment is started before the multiline
So for example the following would not be treated as a multiline starter:</p>


<div class="highlight"><pre><code> <span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">);</span> <span class="c1">// Alert some foo /* Random open comment thing</span>
</code></pre></div>


        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nx">matchable</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">multiLine</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;&amp;</span>
        <span class="o">!</span><span class="nx">matchable</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">multiLine</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;&#39;</span><span class="p">).</span><span class="nx">match</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">multiLine</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&amp;&amp;</span>
        <span class="p">(</span><span class="o">!</span><span class="nx">params</span><span class="p">.</span><span class="nx">comment</span> <span class="o">||</span> <span class="o">!</span><span class="nx">matchable</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">multiLine</span><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="mi">0</span><span class="p">].</span><span class="nx">match</span><span class="p">(</span><span class="nx">commentRegex</span><span class="p">))</span>
      <span class="p">){</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-50" id="section-50">&#182;</a>
</div>
<p>Here we start parsing a multiline comment. Store away the current section and start a new one</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="k">if</span><span class="p">(</span><span class="nx">section</span><span class="p">.</span><span class="nx">code</span><span class="p">){</span>
          <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">section</span><span class="p">.</span><span class="nx">code</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^\s*$/</span><span class="p">)</span> <span class="o">||</span> <span class="o">!</span><span class="nx">section</span><span class="p">.</span><span class="nx">docs</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^\s*$/</span><span class="p">))</span> <span class="nx">sections</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">section</span><span class="p">);</span>
          <span class="nx">section</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">docs</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nx">code</span><span class="o">:</span> <span class="s1">&#39;&#39;</span> <span class="p">};</span>
        <span class="p">}</span>
        <span class="nx">inMultiLineComment</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="nx">multiLine</span> <span class="o">=</span> <span class="nx">line</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span><span class="p">;</span>
        <span class="k">continue</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">if</span><span class="p">(</span>
      <span class="nx">params</span><span class="p">.</span><span class="nx">comment</span> <span class="o">&amp;&amp;</span>
      <span class="nx">matchable</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">commentRegex</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
      <span class="p">(</span><span class="o">!</span><span class="nx">params</span><span class="p">.</span><span class="nx">commentsIgnore</span> <span class="o">||</span> <span class="o">!</span><span class="nx">matchable</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">commentsIgnore</span><span class="p">))</span> <span class="o">&amp;&amp;</span>
      <span class="o">!</span><span class="nx">matchable</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/#!/</span><span class="p">)</span>
    <span class="p">){</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-51" id="section-51">&#182;</a>
</div>
<p>This is for single-line comments. Again, store away the last section and start a new one</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">if</span><span class="p">(</span><span class="nx">section</span><span class="p">.</span><span class="nx">code</span><span class="p">){</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">section</span><span class="p">.</span><span class="nx">code</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^\s*$/</span><span class="p">)</span> <span class="o">||</span> <span class="o">!</span><span class="nx">section</span><span class="p">.</span><span class="nx">docs</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^\s*$/</span><span class="p">))</span> <span class="nx">sections</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">section</span><span class="p">);</span>
        <span class="nx">section</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">docs</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nx">code</span><span class="o">:</span> <span class="s1">&#39;&#39;</span> <span class="p">};</span>
      <span class="p">}</span>
      <span class="nx">section</span><span class="p">.</span><span class="nx">docs</span> <span class="o">+=</span> <span class="nx">line</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">commentRegex</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;\n&#39;</span><span class="p">;</span>
    <span class="p">}</span><span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">params</span><span class="p">.</span><span class="nx">commentsIgnore</span> <span class="o">||</span> <span class="o">!</span><span class="nx">line</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">commentsIgnore</span><span class="p">)){</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-52" id="section-52">&#182;</a>
</div>
<p>If this is the first line of active code, store it in the section
so we can grab it for line numbers later</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">section</span><span class="p">.</span><span class="nx">firstCodeLine</span><span class="p">){</span>
        <span class="nx">section</span><span class="p">.</span><span class="nx">firstCodeLine</span> <span class="o">=</span> <span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nx">section</span><span class="p">.</span><span class="nx">code</span> <span class="o">+=</span> <span class="nx">line</span> <span class="o">+</span> <span class="s1">&#39;\n&#39;</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="nx">sections</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">section</span><span class="p">);</span>
  <span class="k">return</span> <span class="nx">sections</span><span class="p">;</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="docker.prototype.parsemultline">
  <h2>
    <a href="#docker.prototype.parsemultline" class="pilcrow">&#182;</a>
    Docker.prototype.parseMultline
  </h2>
</div>

  </div>
  <div class="body"><p>Parse a multiline comment for jsDoc &agrave; la <a href="https://github.com/visionmedia/dox">dox</a></p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">comment</span>
      <span class="dox_type">string</span>
      <span>The comment to parse</span>
    </div>
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">object</span>
      <span>Object containing parsed comment data</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">Docker</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">parseMultiline</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">comment</span><span class="p">){</span>
  <span class="kd">var</span> <span class="nx">commentData</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">tags</span><span class="o">:</span> <span class="p">[],</span> <span class="nx">description</span><span class="o">:</span> <span class="p">{}</span> <span class="p">};</span>

  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="sr">/^\s*@/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">comment</span><span class="p">)){</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-54" id="section-54">&#182;</a>
</div>
<p>Split out a summary and body from the comment</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="kd">var</span> <span class="nx">full</span> <span class="o">=</span> <span class="nx">comment</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;\n@&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>

    <span class="nx">commentData</span><span class="p">.</span><span class="nx">description</span><span class="p">.</span><span class="nx">summary</span> <span class="o">=</span> <span class="nx">full</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="sr">/\n\s*\n\s*/</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
    <span class="nx">commentData</span><span class="p">.</span><span class="nx">description</span><span class="p">.</span><span class="nx">body</span> <span class="o">=</span> <span class="nx">full</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="sr">/\n\s*\n\s*/</span><span class="p">).</span><span class="nx">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;\n\n&#39;</span><span class="p">);</span>

  <span class="p">}</span><span class="k">else</span><span class="p">{</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-55" id="section-55">&#182;</a>
</div>
<p>If the comment starts with a tag, do nothing</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">commentData</span><span class="p">.</span><span class="nx">description</span><span class="p">.</span><span class="nx">summary</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
    <span class="nx">commentData</span><span class="p">.</span><span class="nx">description</span><span class="p">.</span><span class="nx">body</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
  <span class="p">}</span>



</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-56" id="section-56">&#182;</a>
</div>
<p>grabType function grabs the type out of an array of space-separated
bits, so for example we can pick up {string, optional} from the beginning
of a tag. <code>bits</code> is passed in as an array so we can shift and unshift
to remove the type from it.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="kd">function</span> <span class="nx">grabType</span><span class="p">(</span><span class="nx">bits</span><span class="p">){</span>
    <span class="kd">var</span> <span class="nx">type</span> <span class="o">=</span> <span class="nx">bits</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-57" id="section-57">&#182;</a>
</div>
<p>Carry on adding bits until we reach a closing brace</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">while</span><span class="p">(</span><span class="nx">bits</span><span class="p">.</span><span class="nx">length</span> <span class="o">&amp;&amp;</span> <span class="nx">type</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;}&#39;</span><span class="p">)</span> <span class="o">===</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="nx">type</span> <span class="o">+=</span> <span class="nx">bits</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-58" id="section-58">&#182;</a>
</div>
<p>If for whatever reason the tag was of the format {type}blah without
the trailing space after the }, extract whatever was left over and
put it back onto the bits array.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="sr">/\}$/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">type</span><span class="p">)){</span>
      <span class="nx">bits</span><span class="p">.</span><span class="nx">unshift</span><span class="p">(</span><span class="nx">type</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^.*\}(.*)$/</span><span class="p">,</span> <span class="s1">&#39;$1&#39;</span><span class="p">));</span>
      <span class="nx">type</span> <span class="o">=</span> <span class="nx">type</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\}.*$/</span><span class="p">,</span><span class="s1">&#39;}&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">type</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/[{}]/g</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
  <span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-59" id="section-59">&#182;</a>
</div>
<p>Prepend a newline here in case the comment starts with a tag</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nx">comment</span> <span class="o">=</span> <span class="s1">&#39;\n&#39;</span> <span class="o">+</span> <span class="nx">comment</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-60" id="section-60">&#182;</a>
</div>
<p>If we have jsDoc-style parameters, parse them</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">if</span><span class="p">(</span><span class="nx">comment</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;\n@&#39;</span><span class="p">)</span> <span class="o">!==</span> <span class="o">-</span><span class="mi">1</span><span class="p">){</span>
    <span class="kd">var</span> <span class="nx">tags</span> <span class="o">=</span> <span class="nx">comment</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;\n@&#39;</span><span class="p">).</span><span class="nx">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-61" id="section-61">&#182;</a>
</div>
<p>Loop through all of the tags and process the ones we support</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">commentData</span><span class="p">.</span><span class="nx">tags</span> <span class="o">=</span> <span class="nx">tags</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">line</span><span class="p">){</span>
      <span class="kd">var</span> <span class="nx">bits</span> <span class="o">=</span> <span class="nx">line</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">),</span> <span class="nx">tag</span> <span class="o">=</span> <span class="p">{};</span>
      <span class="kd">var</span> <span class="nx">tagType</span> <span class="o">=</span> <span class="nx">tag</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="nx">bits</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>

      <span class="k">switch</span><span class="p">(</span><span class="nx">tagType</span><span class="p">){</span>
        <span class="k">case</span> <span class="s1">&#39;param&#39;</span><span class="o">:</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-62" id="section-62">&#182;</a>
</div>
<p><code>@param {typename} paramname Parameter description</code></p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
          <span class="k">if</span><span class="p">(</span><span class="nx">bits</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;{&#39;</span><span class="p">)</span> <span class="nx">tag</span><span class="p">.</span><span class="nx">types</span> <span class="o">=</span> <span class="nx">grabType</span><span class="p">(</span><span class="nx">bits</span><span class="p">).</span><span class="nx">split</span><span class="p">(</span><span class="sr">/ *[|,\/] */</span><span class="p">);</span>
          <span class="nx">tag</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">bits</span><span class="p">.</span><span class="nx">shift</span><span class="p">()</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
          <span class="nx">tag</span><span class="p">.</span><span class="nx">description</span> <span class="o">=</span> <span class="nx">bits</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">);</span>
          <span class="k">break</span><span class="p">;</span>

        <span class="k">case</span> <span class="s1">&#39;return&#39;</span><span class="o">:</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-63" id="section-63">&#182;</a>
</div>
<p><code>@return {typename} Return description</code></p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
          <span class="k">if</span><span class="p">(</span><span class="nx">bits</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;{&#39;</span><span class="p">)</span> <span class="nx">tag</span><span class="p">.</span><span class="nx">types</span> <span class="o">=</span> <span class="nx">grabType</span><span class="p">(</span><span class="nx">bits</span><span class="p">).</span><span class="nx">split</span><span class="p">(</span><span class="sr">/ *[|,\/] */</span><span class="p">);</span>
          <span class="nx">tag</span><span class="p">.</span><span class="nx">description</span> <span class="o">=</span> <span class="nx">bits</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">);</span>
          <span class="k">break</span><span class="p">;</span>

        <span class="k">case</span> <span class="s1">&#39;type&#39;</span><span class="o">:</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-64" id="section-64">&#182;</a>
</div>
<p><code>@type {typename}</code></p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
          <span class="nx">tag</span><span class="p">.</span><span class="nx">types</span> <span class="o">=</span> <span class="nx">grabType</span><span class="p">(</span><span class="nx">bits</span><span class="p">).</span><span class="nx">split</span><span class="p">(</span><span class="sr">/ *[|,\/] */</span><span class="p">);</span>
          <span class="k">break</span><span class="p">;</span>

        <span class="k">case</span> <span class="s1">&#39;api&#39;</span><span class="o">:</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-65" id="section-65">&#182;</a>
</div>
<p><code>@api public</code> or <code>@api private</code> etc.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
          <span class="nx">tag</span><span class="p">.</span><span class="nx">visibility</span> <span class="o">=</span> <span class="nx">bits</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>
          <span class="k">break</span><span class="p">;</span>

        <span class="k">case</span> <span class="s1">&#39;see&#39;</span><span class="o">:</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-66" id="section-66">&#182;</a>
</div>
<p><code>@see Title http://url</code> or <code>@see local place</code></p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
          <span class="k">if</span><span class="p">(</span><span class="sr">/http/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">line</span><span class="p">)){</span>
            <span class="nx">tag</span><span class="p">.</span><span class="nx">title</span> <span class="o">=</span> <span class="nx">bits</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">?</span> <span class="nx">bits</span><span class="p">.</span><span class="nx">shift</span><span class="p">()</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
            <span class="nx">tag</span><span class="p">.</span><span class="nx">url</span> <span class="o">=</span> <span class="nx">bits</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">);</span>
          <span class="p">}</span><span class="k">else</span><span class="p">{</span>
            <span class="nx">tag</span><span class="p">.</span><span class="nx">local</span> <span class="o">=</span> <span class="nx">bits</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">);</span>
          <span class="p">}</span>
          <span class="k">break</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="k">return</span> <span class="nx">tag</span><span class="p">;</span>
    <span class="p">});</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="nx">commentData</span><span class="p">;</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="docker.prototype.outdent">
  <h2>
    <a href="#docker.prototype.outdent" class="pilcrow">&#182;</a>
    Docker.prototype.outdent
  </h2>
</div>

  </div>
  <div class="body"><p>Attempts to automatically detect indented lines in multiline comments
and bring them back to normal indentation level. This is to avoid markdown
picking up indented lines and thinking they're code</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">code</span>
      <span class="dox_type">string</span>
      <span>The code to attempt to outdent</span>
    </div>
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">string</span>
      <span>Outdented code</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">Docker</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">outdent</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">code</span><span class="p">){</span>
  <span class="kd">var</span> <span class="nx">lines</span> <span class="o">=</span> <span class="nx">code</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;\n&#39;</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">tabWidth</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">smallestIndent</span> <span class="o">=</span> <span class="kc">Infinity</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-68" id="section-68">&#182;</a>
</div>
<p>Loop through all the lines, finding the least-indented of all of them</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">lines</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">){</span>
    <span class="kd">var</span> <span class="nx">line</span> <span class="o">=</span> <span class="nx">lines</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\t/g</span><span class="p">,</span> <span class="nb">Array</span><span class="p">(</span><span class="nx">tabWidth</span><span class="o">+</span><span class="mi">1</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">));</span>
    <span class="k">if</span><span class="p">(</span><span class="sr">/^\s$/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">line</span><span class="p">))</span> <span class="k">continue</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">lineIndent</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">while</span><span class="p">(</span><span class="nx">line</span><span class="p">.</span><span class="nx">length</span> <span class="o">&amp;&amp;</span> <span class="nx">line</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39; &#39;</span><span class="p">){</span>
      <span class="nx">line</span> <span class="o">=</span> <span class="nx">line</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
      <span class="nx">lineIndent</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-69" id="section-69">&#182;</a>
</div>
<p>If the line consists entirely of whitespace, don't factor it into
the calculation (editors that trim trailing whitespace may make the
line shorter)</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">if</span><span class="p">(</span><span class="nx">line</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="nx">smallestIndent</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">lineIndent</span><span class="p">,</span> <span class="nx">smallestIndent</span><span class="p">);</span>
  <span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-70" id="section-70">&#182;</a>
</div>
<p>This should only happen if the input code was entirely
whitespace, which should never be the case</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nb">isFinite</span><span class="p">(</span><span class="nx">smallestIndent</span><span class="p">))</span> <span class="nx">smallestIndent</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-71" id="section-71">&#182;</a>
</div>
<p>Now loop over lines again and outdent them by the largest possible amount</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="kd">var</span> <span class="nx">outLines</span> <span class="o">=</span> <span class="p">[];</span>

  <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">lines</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">j</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">){</span>
    <span class="kd">var</span> <span class="nx">line</span> <span class="o">=</span> <span class="nx">lines</span><span class="p">[</span><span class="nx">j</span><span class="p">].</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\t/g</span><span class="p">,</span> <span class="nb">Array</span><span class="p">(</span><span class="nx">tabWidth</span><span class="o">+</span><span class="mi">1</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">));</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-72" id="section-72">&#182;</a>
</div>
<p>If the line was smaller than the smallestIndent it's because
it was entirely whitespace anyway, so we're safe to do this.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">outLines</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">line</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="nx">smallestIndent</span><span class="p">));</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="nx">outLines</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;\n&#39;</span><span class="p">);</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="docker.prototype.languageparams">
  <h2>
    <a href="#docker.prototype.languageparams" class="pilcrow">&#182;</a>
    Docker.prototype.languageParams
  </h2>
</div>

  </div>
  <div class="body"><p>Provides language-specific params for a given file name.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">filename</span>
      <span class="dox_type">string</span>
      <span>The name of the file to test</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">filedata</span>
      <span class="dox_type">string</span>
      <span>The contents of the file (to check for shebang)</span>
    </div>
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">object</span>
      <span>Object containing all of the language-specific params</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">Docker</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">languageParams</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">filename</span><span class="p">,</span> <span class="nx">filedata</span><span class="p">){</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-74" id="section-74">&#182;</a>
</div>
<p>First try to detect the language from the file extension</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="kd">var</span> <span class="nx">ext</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">extname</span><span class="p">(</span><span class="nx">filename</span><span class="p">);</span>
  <span class="nx">ext</span> <span class="o">=</span> <span class="nx">ext</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^\./</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-75" id="section-75">&#182;</a>
</div>
<p>Bit of a hacky way of incorporating .C for C++</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">if</span><span class="p">(</span><span class="nx">ext</span> <span class="o">===</span> <span class="s1">&#39;.C&#39;</span><span class="p">)</span> <span class="k">return</span> <span class="s1">&#39;cpp&#39;</span><span class="p">;</span>
  <span class="nx">ext</span> <span class="o">=</span> <span class="nx">ext</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">();</span>

  <span class="kd">var</span> <span class="nx">base</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">basename</span><span class="p">(</span><span class="nx">filename</span><span class="p">);</span>
  <span class="nx">base</span> <span class="o">=</span> <span class="nx">base</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">();</span>

  <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">languages</span><span class="p">){</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">languages</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">i</span><span class="p">))</span> <span class="k">continue</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">languages</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">extensions</span> <span class="o">&amp;&amp;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">languages</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">extensions</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">ext</span><span class="p">)</span> <span class="o">!==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">return</span> <span class="nx">i</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">languages</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">names</span> <span class="o">&amp;&amp;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">languages</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">names</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">base</span><span class="p">)</span> <span class="o">!==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">return</span> <span class="nx">i</span><span class="p">;</span>
  <span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-76" id="section-76">&#182;</a>
</div>
<p>If that doesn't work, see if we can grab a shebang</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>

  <span class="kd">var</span> <span class="nx">shebangRegex</span> <span class="o">=</span> <span class="sr">/^\n*#!\s*(?:\/usr\/bin\/env)?\s*(?:[^\n]*\/)*([^\/\n]+)(?:\n|$)/</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">match</span> <span class="o">=</span> <span class="nx">shebangRegex</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="nx">filedata</span><span class="p">);</span>
  <span class="k">if</span><span class="p">(</span><span class="nx">match</span><span class="p">){</span>
    <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">j</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">languages</span><span class="p">){</span>
      <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">languages</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">j</span><span class="p">))</span> <span class="k">continue</span><span class="p">;</span>
      <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">languages</span><span class="p">[</span><span class="nx">j</span><span class="p">].</span><span class="nx">executables</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">languages</span><span class="p">[</span><span class="nx">j</span><span class="p">].</span><span class="nx">executables</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">match</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">!==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">return</span> <span class="nx">j</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-77" id="section-77">&#182;</a>
</div>
<p>If we still can't figure it out, give up and return false.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
<span class="p">};</span>



</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-78" id="section-78">&#182;</a>
</div>
<p>The language params can have the following keys:</p>

<ul>
<li><code>name</code>: Name of Pygments lexer to use</li>
<li><code>comment</code>: String flag for single-line comments</li>
<li><code>multiline</code>: Two-element array of start and end flags for block comments</li>
<li><code>commentsIgnore</code>: Regex of comments to strip completely (don't even doc)</li>
<li><code>jsDoc</code>: Whether to parse multiline comments as jsDoc</li>
<li><code>type</code>: Either <code>'code'</code> (default) or <code>'markdown'</code> - format of page to render</li>
</ul>

<p>I'm not even going to pretend that this is an exhaustive list of
languages that Pygments can understand. This is just a list of the most
common ones I think are necessary. If you can think of another that
might be useful, and can find it on the <a href="http://pygments.org/docs/lexers/">Pygments lexer page</a>,
then let me know and I'll add it in</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">Docker</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">languages</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">javascript</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">extensions</span><span class="o">:</span> <span class="p">[</span> <span class="s1">&#39;js&#39;</span> <span class="p">],</span>
    <span class="nx">executables</span><span class="o">:</span> <span class="p">[</span> <span class="s1">&#39;node&#39;</span> <span class="p">],</span>
    <span class="nx">comment</span><span class="o">:</span> <span class="s1">&#39;//&#39;</span><span class="p">,</span> <span class="nx">multiLine</span><span class="o">:</span> <span class="p">[</span> <span class="sr">/\/\*\*?/</span><span class="p">,</span> <span class="sr">/\*\//</span> <span class="p">],</span> <span class="nx">commentsIgnore</span><span class="o">:</span> <span class="sr">/^\s*\/\/=/</span><span class="p">,</span> <span class="nx">jsDoc</span><span class="o">:</span> <span class="kc">true</span>
  <span class="p">},</span>
  <span class="nx">coffeescript</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">extensions</span><span class="o">:</span> <span class="p">[</span> <span class="s1">&#39;coffee&#39;</span> <span class="p">],</span>
    <span class="nx">executables</span><span class="o">:</span> <span class="p">[</span> <span class="s1">&#39;coffee&#39;</span> <span class="p">],</span>
    <span class="nx">comment</span><span class="o">:</span> <span class="s1">&#39;#&#39;</span><span class="p">,</span>  <span class="nx">multiLine</span><span class="o">:</span> <span class="p">[</span> <span class="sr">/^\s*#{3}\s*$/m</span><span class="p">,</span> <span class="sr">/^\s*#{3}\s*$/m</span> <span class="p">],</span> <span class="nx">jsDoc</span><span class="o">:</span> <span class="kc">true</span>
  <span class="p">},</span>
  <span class="nx">ruby</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">extensions</span><span class="o">:</span> <span class="p">[</span> <span class="s1">&#39;rb&#39;</span><span class="p">,</span> <span class="s1">&#39;rbw&#39;</span><span class="p">,</span> <span class="s1">&#39;rake&#39;</span><span class="p">,</span> <span class="s1">&#39;gemspec&#39;</span> <span class="p">],</span>
    <span class="nx">executables</span><span class="o">:</span> <span class="p">[</span> <span class="s1">&#39;ruby&#39;</span> <span class="p">],</span>
    <span class="nx">names</span><span class="o">:</span> <span class="p">[</span> <span class="s1">&#39;rakefile&#39;</span> <span class="p">],</span>
    <span class="nx">comment</span><span class="o">:</span> <span class="s1">&#39;#&#39;</span><span class="p">,</span>  <span class="nx">multiLine</span><span class="o">:</span> <span class="p">[</span> <span class="sr">/\=begin/</span><span class="p">,</span> <span class="sr">/\=end/</span> <span class="p">]</span>
  <span class="p">},</span>
  <span class="nx">python</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">extensions</span><span class="o">:</span> <span class="p">[</span> <span class="s1">&#39;py&#39;</span> <span class="p">],</span>
    <span class="nx">executables</span><span class="o">:</span> <span class="p">[</span> <span class="s1">&#39;python&#39;</span> <span class="p">],</span>
    <span class="nx">comment</span><span class="o">:</span> <span class="s1">&#39;#&#39;</span> <span class="c1">// Python has no block commments :-(</span>
  <span class="p">},</span>
  <span class="nx">perl</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">extensions</span><span class="o">:</span> <span class="p">[</span> <span class="s1">&#39;pl&#39;</span><span class="p">,</span> <span class="s1">&#39;pm&#39;</span> <span class="p">],</span>
    <span class="nx">executables</span><span class="o">:</span> <span class="p">[</span> <span class="s1">&#39;perl&#39;</span> <span class="p">],</span>
    <span class="nx">comment</span><span class="o">:</span> <span class="s1">&#39;#&#39;</span> <span class="c1">// Nor (really) does perl.</span>
  <span class="p">},</span>
  <span class="nx">c</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">extensions</span><span class="o">:</span> <span class="p">[</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span> <span class="p">],</span>
    <span class="nx">executables</span><span class="o">:</span> <span class="p">[</span> <span class="s1">&#39;gcc&#39;</span> <span class="p">],</span>
    <span class="nx">comment</span><span class="o">:</span> <span class="s1">&#39;//&#39;</span><span class="p">,</span> <span class="nx">multiLine</span><span class="o">:</span> <span class="p">[</span> <span class="sr">/\/\*\*?/</span><span class="p">,</span> <span class="sr">/\*\//</span> <span class="p">],</span> <span class="nx">jsDoc</span><span class="o">:</span> <span class="kc">true</span>
  <span class="p">},</span>
  <span class="nx">cpp</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">extensions</span><span class="o">:</span> <span class="p">[</span> <span class="s1">&#39;cc&#39;</span><span class="p">,</span> <span class="s1">&#39;cpp&#39;</span> <span class="p">],</span>
    <span class="nx">executables</span><span class="o">:</span> <span class="p">[</span> <span class="s1">&#39;g++&#39;</span> <span class="p">],</span>
    <span class="nx">comment</span><span class="o">:</span> <span class="s1">&#39;//&#39;</span><span class="p">,</span> <span class="nx">multiLine</span><span class="o">:</span> <span class="p">[</span> <span class="sr">/\/\*\*?/</span><span class="p">,</span> <span class="sr">/\*\//</span> <span class="p">],</span> <span class="nx">jsDoc</span><span class="o">:</span> <span class="kc">true</span>
  <span class="p">},</span>
  <span class="nx">vbnet</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">extensions</span><span class="o">:</span> <span class="p">[</span> <span class="s1">&#39;vb&#39;</span><span class="p">,</span> <span class="s1">&#39;vbs&#39;</span><span class="p">,</span> <span class="s1">&#39;bas&#39;</span> <span class="p">],</span>
    <span class="nx">comment</span><span class="o">:</span> <span class="s2">&quot;&#39;&quot;</span> <span class="c1">// No multiline</span>
  <span class="p">},</span>
  <span class="s1">&#39;aspx-vb&#39;</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">extensions</span><span class="o">:</span> <span class="p">[</span> <span class="s1">&#39;asp&#39;</span><span class="p">,</span> <span class="s1">&#39;aspx&#39;</span><span class="p">,</span> <span class="s1">&#39;asax&#39;</span><span class="p">,</span> <span class="s1">&#39;ascx&#39;</span><span class="p">,</span> <span class="s1">&#39;ashx&#39;</span><span class="p">,</span> <span class="s1">&#39;asmx&#39;</span><span class="p">,</span> <span class="s1">&#39;axd&#39;</span> <span class="p">],</span>
    <span class="nx">comment</span><span class="o">:</span> <span class="s2">&quot;&#39;&quot;</span> <span class="c1">// No multiline</span>
  <span class="p">},</span>
  <span class="nx">csharp</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">extensions</span><span class="o">:</span> <span class="p">[</span> <span class="s1">&#39;cs&#39;</span> <span class="p">],</span>
    <span class="nx">comment</span><span class="o">:</span> <span class="s1">&#39;//&#39;</span><span class="p">,</span> <span class="nx">multiLine</span><span class="o">:</span> <span class="p">[</span> <span class="sr">/\/\*\*?/</span><span class="p">,</span> <span class="sr">/\*\//</span> <span class="p">],</span> <span class="nx">jsDoc</span><span class="o">:</span> <span class="kc">true</span>
  <span class="p">},</span>
  <span class="s1">&#39;aspx-cs&#39;</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">extensions</span><span class="o">:</span> <span class="p">[</span> <span class="s1">&#39;aspx&#39;</span><span class="p">,</span> <span class="s1">&#39;asax&#39;</span><span class="p">,</span> <span class="s1">&#39;ascx&#39;</span><span class="p">,</span> <span class="s1">&#39;ashx&#39;</span><span class="p">,</span> <span class="s1">&#39;asmx&#39;</span><span class="p">,</span> <span class="s1">&#39;axd&#39;</span> <span class="p">],</span>
    <span class="nx">comment</span><span class="o">:</span> <span class="s1">&#39;//&#39;</span><span class="p">,</span> <span class="nx">multiLine</span><span class="o">:</span> <span class="p">[</span> <span class="sr">/\/\*\*?/</span><span class="p">,</span> <span class="sr">/\*\//</span> <span class="p">],</span> <span class="nx">jsDoc</span><span class="o">:</span> <span class="kc">true</span>
  <span class="p">},</span>
  <span class="nx">java</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">extensions</span><span class="o">:</span> <span class="p">[</span> <span class="s1">&#39;java&#39;</span> <span class="p">],</span>
    <span class="nx">comment</span><span class="o">:</span> <span class="s1">&#39;//&#39;</span><span class="p">,</span> <span class="nx">multiLine</span><span class="o">:</span> <span class="p">[</span> <span class="sr">/\/\*\*?/</span><span class="p">,</span> <span class="sr">/\*\//</span> <span class="p">],</span> <span class="nx">jsDoc</span><span class="o">:</span> <span class="kc">true</span>
  <span class="p">},</span>
  <span class="nx">php</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">extensions</span><span class="o">:</span> <span class="p">[</span> <span class="s1">&#39;php&#39;</span><span class="p">,</span> <span class="s1">&#39;php3&#39;</span><span class="p">,</span> <span class="s1">&#39;php4&#39;</span><span class="p">,</span> <span class="s1">&#39;php5&#39;</span> <span class="p">],</span>
    <span class="nx">executables</span><span class="o">:</span> <span class="p">[</span> <span class="s1">&#39;php&#39;</span> <span class="p">],</span>
    <span class="nx">comment</span><span class="o">:</span> <span class="s1">&#39;//&#39;</span><span class="p">,</span> <span class="nx">multiLine</span><span class="o">:</span> <span class="p">[</span> <span class="sr">/\/\*\*?/</span><span class="p">,</span> <span class="sr">/\*\//</span> <span class="p">],</span> <span class="nx">jsDoc</span><span class="o">:</span> <span class="kc">true</span>
  <span class="p">},</span>
  <span class="nx">actionscript</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">extensions</span><span class="o">:</span> <span class="p">[</span> <span class="s1">&#39;as&#39;</span> <span class="p">],</span>
    <span class="nx">comment</span><span class="o">:</span> <span class="s1">&#39;//&#39;</span><span class="p">,</span> <span class="nx">multiLine</span><span class="o">:</span> <span class="p">[</span> <span class="sr">/\/\*/</span><span class="p">,</span> <span class="sr">/\*\//</span> <span class="p">]</span>
  <span class="p">},</span>
  <span class="nx">sh</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">extensions</span><span class="o">:</span> <span class="p">[</span> <span class="s1">&#39;sh&#39;</span><span class="p">,</span> <span class="s1">&#39;kst&#39;</span><span class="p">,</span> <span class="s1">&#39;bash&#39;</span> <span class="p">],</span>
    <span class="nx">names</span><span class="o">:</span> <span class="p">[</span> <span class="s1">&#39;.bashrc&#39;</span><span class="p">,</span> <span class="s1">&#39;bashrc&#39;</span> <span class="p">],</span>
    <span class="nx">executables</span><span class="o">:</span> <span class="p">[</span> <span class="s1">&#39;bash&#39;</span><span class="p">,</span> <span class="s1">&#39;sh&#39;</span><span class="p">,</span> <span class="s1">&#39;zsh&#39;</span> <span class="p">],</span>
    <span class="nx">comment</span><span class="o">:</span> <span class="s1">&#39;#&#39;</span>
  <span class="p">},</span>
  <span class="nx">yaml</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">extensions</span><span class="o">:</span> <span class="p">[</span> <span class="s1">&#39;yaml&#39;</span><span class="p">,</span> <span class="s1">&#39;yml&#39;</span> <span class="p">],</span>
    <span class="nx">comment</span><span class="o">:</span> <span class="s1">&#39;#&#39;</span>
  <span class="p">},</span>
  <span class="nx">markdown</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">extensions</span><span class="o">:</span> <span class="p">[</span> <span class="s1">&#39;md&#39;</span><span class="p">,</span> <span class="s1">&#39;mkd&#39;</span><span class="p">,</span> <span class="s1">&#39;markdown&#39;</span> <span class="p">],</span>
    <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;markdown&#39;</span>
  <span class="p">},</span>
  <span class="nx">sass</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">extensions</span><span class="o">:</span> <span class="p">[</span> <span class="s1">&#39;sass&#39;</span> <span class="p">],</span>
    <span class="nx">comment</span><span class="o">:</span> <span class="s1">&#39;//&#39;</span> <span class="c1">//, multiLine: [ /\/\*/, /\*\// ]</span>
  <span class="p">},</span>
  <span class="nx">scss</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">extensions</span><span class="o">:</span> <span class="p">[</span> <span class="s1">&#39;scss&#39;</span> <span class="p">],</span>
    <span class="nx">comment</span><span class="o">:</span> <span class="s1">&#39;//&#39;</span> <span class="c1">//, multiLine: [ /\/\*/, /\*\// ]</span>
  <span class="p">},</span>
  <span class="nx">make</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">names</span><span class="o">:</span> <span class="p">[</span> <span class="s1">&#39;makefile&#39;</span> <span class="p">],</span>
    <span class="nx">comment</span><span class="o">:</span> <span class="s1">&#39;#&#39;</span>
  <span class="p">},</span>
  <span class="nx">apache</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">names</span><span class="o">:</span> <span class="p">[</span> <span class="s1">&#39;.htaccess&#39;</span><span class="p">,</span> <span class="s1">&#39;apache.conf&#39;</span><span class="p">,</span> <span class="s1">&#39;apache2.conf&#39;</span> <span class="p">],</span>
    <span class="nx">comment</span><span class="o">:</span> <span class="s1">&#39;#&#39;</span>
  <span class="p">},</span>
  <span class="nx">jade</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">extensions</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;jade&#39;</span><span class="p">],</span>
    <span class="nx">comment</span><span class="o">:</span> <span class="s1">&#39;//&#39;</span><span class="p">,</span> <span class="nx">multiLine</span><span class="o">:</span> <span class="p">[</span> <span class="sr">/\/\*\*?/</span><span class="p">,</span> <span class="sr">/\*\//</span> <span class="p">],</span> <span class="nx">jsDoc</span><span class="o">:</span> <span class="kc">true</span>
  <span class="p">},</span>
  <span class="nx">groovy</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">extensions</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;groovy&#39;</span><span class="p">],</span>
    <span class="nx">comment</span><span class="o">:</span> <span class="s1">&#39;//&#39;</span><span class="p">,</span> <span class="nx">multiLine</span><span class="o">:</span> <span class="p">[</span> <span class="sr">/\/\*\*?/</span><span class="p">,</span> <span class="sr">/\*\//</span> <span class="p">],</span> <span class="nx">jsDoc</span><span class="o">:</span> <span class="kc">true</span>
  <span class="p">},</span>
  <span class="nx">gsp</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">extensions</span><span class="o">:</span> <span class="p">[</span> <span class="s1">&#39;gsp&#39;</span> <span class="p">],</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-79" id="section-79">&#182;</a>
</div>
<p>comment: '//', gsp only supports multiline comments.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">multiLine</span><span class="o">:</span> <span class="p">[</span> <span class="sr">/&lt;%--/</span><span class="p">,</span> <span class="sr">/--%&gt;/</span> <span class="p">],</span>
    <span class="nx">pygment</span><span class="o">:</span> <span class="s2">&quot;html&quot;</span><span class="c1">// .gsp is grails server pages in pygments, html is close enough.</span>
  <span class="p">},</span>
  <span class="nx">styl</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">extensions</span><span class="o">:</span> <span class="p">[</span> <span class="s1">&#39;styl&#39;</span> <span class="p">],</span>
    <span class="nx">comment</span><span class="o">:</span> <span class="s1">&#39;//&#39;</span><span class="p">,</span> <span class="nx">multiLine</span><span class="o">:</span> <span class="p">[</span> <span class="sr">/\/\*/</span><span class="p">,</span> <span class="sr">/\*\//</span> <span class="p">],</span>
    <span class="nx">pygment</span><span class="o">:</span> <span class="s2">&quot;sass&quot;</span><span class="c1">// .styl isn&#39;t supported by pygments, sass is close enough.</span>
  <span class="p">},</span>
  <span class="nx">css</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">extensions</span><span class="o">:</span> <span class="p">[</span> <span class="s1">&#39;css&#39;</span> <span class="p">],</span>
    <span class="nx">multiLine</span><span class="o">:</span> <span class="p">[</span> <span class="sr">/\/\*/</span><span class="p">,</span> <span class="sr">/\*\//</span> <span class="p">],</span>
  <span class="p">},</span>
  <span class="nx">html</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">extensions</span><span class="o">:</span> <span class="p">[</span> <span class="s1">&#39;html&#39;</span><span class="p">,</span> <span class="s1">&#39;htm&#39;</span> <span class="p">],</span>
    <span class="nx">multiLine</span><span class="o">:</span> <span class="p">[</span> <span class="sr">/&lt;!--/</span><span class="p">,</span> <span class="sr">/--&gt;/</span> <span class="p">]</span>
  <span class="p">}</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="docker.prototype.pygments">
  <h2>
    <a href="#docker.prototype.pygments" class="pilcrow">&#182;</a>
    Docker.prototype.pygments
  </h2>
</div>

  </div>
  <div class="body"><p>Runs a given block of code through pygments</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">data</span>
      <span class="dox_type">string</span>
      <span>The code to give to Pygments</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">language</span>
      <span class="dox_type">string</span>
      <span>The name of the Pygments lexer to use</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">cb</span>
      <span class="dox_type">function</span>
      <span>Callback to fire with Pygments output</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">Docker</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">pygments</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">language</span><span class="p">,</span> <span class="nx">cb</span><span class="p">){</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-81" id="section-81">&#182;</a>
</div>
<p>By default tell Pygments to guess the language, and if
we have a language specified then tell pygments to use that lexer</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="kd">var</span> <span class="nx">pygArgs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;-g&#39;</span><span class="p">];</span>
  <span class="k">if</span><span class="p">(</span><span class="nx">language</span><span class="p">)</span> <span class="nx">pygArgs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;-l&#39;</span><span class="p">,</span> <span class="nx">language</span><span class="p">];</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-82" id="section-82">&#182;</a>
</div>
<p>Spawn a new <strong>pygments</strong> process</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="kd">var</span> <span class="nx">pyg</span> <span class="o">=</span> <span class="nx">spawn</span><span class="p">(</span><span class="s1">&#39;pygmentize&#39;</span><span class="p">,</span> <span class="nx">pygArgs</span><span class="p">.</span><span class="nx">concat</span><span class="p">([</span><span class="s1">&#39;-f&#39;</span><span class="p">,</span> <span class="s1">&#39;html&#39;</span><span class="p">,</span> <span class="s1">&#39;-O&#39;</span><span class="p">,</span> <span class="s1">&#39;encoding=utf-8,tabsize=2&#39;</span><span class="p">]));</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-83" id="section-83">&#182;</a>
</div>
<p>Hook up errors, for either when pygments itself throws an error,
or for when we're unable to send the code to pygments for some reason</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nx">pyg</span><span class="p">.</span><span class="nx">stderr</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">){</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">toString</span><span class="p">());</span> <span class="p">});</span>
  <span class="nx">pyg</span><span class="p">.</span><span class="nx">stdin</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">){</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Unable to write to Pygments stdin: &#39;</span> <span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
    <span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
  <span class="p">});</span>

  <span class="kd">var</span> <span class="nx">out</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
  <span class="nx">pyg</span><span class="p">.</span><span class="nx">stdout</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">){</span> <span class="nx">out</span> <span class="o">+=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">toString</span><span class="p">();</span> <span class="p">});</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-84" id="section-84">&#182;</a>
</div>
<p>When pygments is done, fire the callback with our output</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nx">pyg</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;exit&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="nx">cb</span><span class="p">(</span><span class="nx">out</span><span class="p">);</span>
  <span class="p">});</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-85" id="section-85">&#182;</a>
</div>
<p>Feed pygments with the code</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">if</span><span class="p">(</span><span class="nx">pyg</span><span class="p">.</span><span class="nx">stdin</span><span class="p">.</span><span class="nx">writable</span><span class="p">){</span>
    <span class="nx">pyg</span><span class="p">.</span><span class="nx">stdin</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
    <span class="nx">pyg</span><span class="p">.</span><span class="nx">stdin</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="docker.prototype.highlight">
  <h2>
    <a href="#docker.prototype.highlight" class="pilcrow">&#182;</a>
    Docker.prototype.highlight
  </h2>
</div>

  </div>
  <div class="body"><p>Highlights all the sections of a file using <strong>pygments</strong>
Given an array of section objects, loop through them, and for each
section generate pretty html for the comments and the code, and put them in
<code>docHtml</code> and <code>codeHtml</code> respectively</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">sections</span>
      <span class="dox_type">Array</span>
      <span>Array of section objects</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">language</span>
      <span class="dox_type">string</span>
      <span>Language ith which to highlight the file</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">cb</span>
      <span class="dox_type">function</span>
      <span>Callback function to fire when we're done</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">Docker</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">highlight</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">sections</span><span class="p">,</span> <span class="nx">language</span><span class="p">,</span> <span class="nx">cb</span><span class="p">){</span>
  <span class="kd">var</span> <span class="nx">params</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">languages</span><span class="p">[</span><span class="nx">language</span><span class="p">],</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">,</span> <span class="nx">pygment</span> <span class="o">=</span> <span class="nx">language</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">input</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">sections</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">){</span>
    <span class="nx">input</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">sections</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">code</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="nx">input</span> <span class="o">=</span> <span class="nx">input</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;\n&#39;</span> <span class="o">+</span> <span class="nx">params</span><span class="p">.</span><span class="nx">comment</span> <span class="o">+</span> <span class="s1">&#39;----DIVIDER----\n&#39;</span><span class="p">);</span>

  <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">languages</span><span class="p">[</span><span class="nx">language</span><span class="p">].</span><span class="nx">pygment</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">pygment</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">languages</span><span class="p">[</span><span class="nx">language</span><span class="p">].</span><span class="nx">pygment</span>
  <span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-87" id="section-87">&#182;</a>
</div>
<p>Run our input through pygments, then split the output back up into its constituent sections</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">this</span><span class="p">.</span><span class="nx">pygments</span><span class="p">(</span><span class="nx">input</span><span class="p">,</span> <span class="nx">pygment</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">out</span><span class="p">){</span>
    <span class="nx">out</span> <span class="o">=</span> <span class="nx">out</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^\s*&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;/</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&lt;\/pre&gt;&lt;\/div&gt;\s*$/</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">bits</span> <span class="o">=</span> <span class="nx">out</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="sr">/^&lt;span[^&gt;]*&gt;[^&lt;]+(?:&lt;\/span&gt;&lt;span[^&gt;]*&gt;)?----DIVIDER----&lt;\/span&gt;$/gm</span><span class="p">);</span>
    <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">sections</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">){</span>
      <span class="nx">sections</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">codeHtml</span> <span class="o">=</span> <span class="s1">&#39;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&#39;</span> <span class="o">+</span> <span class="nx">bits</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;&lt;/pre&gt;&lt;/div&gt;&#39;</span><span class="p">;</span>
      <span class="nx">sections</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">docHtml</span> <span class="o">=</span> <span class="nx">showdown</span><span class="p">.</span><span class="nx">makeHtml</span><span class="p">(</span><span class="nx">sections</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">docs</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">self</span><span class="p">.</span><span class="nx">processDocCodeBlocks</span><span class="p">(</span><span class="nx">sections</span><span class="p">,</span> <span class="nx">cb</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="docker.prototype.processdoccodeblocks">
  <h2>
    <a href="#docker.prototype.processdoccodeblocks" class="pilcrow">&#182;</a>
    Docker.prototype.processDocCodeBlocks
  </h2>
</div>

  </div>
  <div class="body"><p>Goes through all the HTML generated from comments, finds any code blocks
and highlights them</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">sections</span>
      <span class="dox_type">Array</span>
      <span>Sections array as above</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">cb</span>
      <span class="dox_type">function</span>
      <span>Callback to fire when done</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">Docker</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">processDocCodeBlocks</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">sections</span><span class="p">,</span> <span class="nx">cb</span><span class="p">){</span>
  <span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

  <span class="kd">function</span> <span class="nx">next</span><span class="p">(){</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-89" id="section-89">&#182;</a>
</div>
<p>If we've reached the end of the sections array, we've highlighted everything,
so we can stop and fire the callback</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">if</span><span class="p">(</span><span class="nx">i</span> <span class="o">==</span> <span class="nx">sections</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="k">return</span> <span class="nx">cb</span><span class="p">();</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-90" id="section-90">&#182;</a>
</div>
<p>Process the code blocks on this section, each time returning the html
and moving onto the next section when we're done</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">self</span><span class="p">.</span><span class="nx">extractDocCode</span><span class="p">(</span><span class="nx">sections</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">docHtml</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">html</span><span class="p">){</span>
      <span class="nx">sections</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">docHtml</span> <span class="o">=</span> <span class="nx">html</span><span class="p">;</span>
      <span class="nx">i</span> <span class="o">=</span> <span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
      <span class="nx">next</span><span class="p">();</span>
    <span class="p">});</span>
  <span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-91" id="section-91">&#182;</a>
</div>
<p>Start off with the first section</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nx">next</span><span class="p">();</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="docker.prototype.extractdoccode">
  <h2>
    <a href="#docker.prototype.extractdoccode" class="pilcrow">&#182;</a>
    Docker.prototype.extractDocCode
  </h2>
</div>

  </div>
  <div class="body"><p>Extract and highlight code blocks in formatted HTML output from showdown</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">html</span>
      <span class="dox_type">string</span>
      <span>The HTML to process</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">cb</span>
      <span class="dox_type">function</span>
      <span>Callback function to fire when done</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">Docker</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">extractDocCode</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">html</span><span class="p">,</span> <span class="nx">cb</span><span class="p">){</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-93" id="section-93">&#182;</a>
</div>
<p>We'll store all extracted code blocks, along with information, in this array</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="kd">var</span> <span class="nx">codeBlocks</span> <span class="o">=</span> <span class="p">[];</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-94" id="section-94">&#182;</a>
</div>
<p>Search in the HTML for any code tag with a language set (in the format that showdown returns)</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nx">html</span> <span class="o">=</span> <span class="nx">html</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&lt;pre&gt;&lt;code(\slanguage=&#39;([a-z]*)&#39;)?&gt;([^&lt;]*)&lt;\/code&gt;&lt;\/pre&gt;/g</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">wholeMatch</span><span class="p">,</span> <span class="nx">langBlock</span><span class="p">,</span> <span class="nx">language</span><span class="p">,</span> <span class="nx">block</span><span class="p">){</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">langBlock</span> <span class="o">===</span> <span class="s1">&#39;&#39;</span> <span class="o">||</span> <span class="nx">language</span> <span class="o">===</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">return</span> <span class="s2">&quot;&lt;div class=&#39;highlight&#39;&gt;&quot;</span> <span class="o">+</span> <span class="nx">wholeMatch</span> <span class="o">+</span> <span class="s1">&#39;&lt;/div&gt;&#39;</span><span class="p">;</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-95" id="section-95">&#182;</a>
</div>
<p>Unescape these HTML entities because they'll be re-escaped by pygments</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">block</span> <span class="o">=</span> <span class="nx">block</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&amp;gt;/g</span><span class="p">,</span><span class="s1">&#39;&gt;&#39;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&amp;lt;/g</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&amp;amp;/g</span><span class="p">,</span><span class="s1">&#39;&amp;&#39;</span><span class="p">);</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-96" id="section-96">&#182;</a>
</div>
<p>Store the code block away in <code>codeBlocks</code> and leave a flag in the original text.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">return</span> <span class="s2">&quot;\n\n~C&quot;</span> <span class="o">+</span> <span class="nx">codeBlocks</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
      <span class="nx">language</span><span class="o">:</span> <span class="nx">language</span><span class="p">,</span>
      <span class="nx">code</span><span class="o">:</span> <span class="nx">block</span><span class="p">,</span>
      <span class="nx">i</span><span class="o">:</span> <span class="nx">codeBlocks</span><span class="p">.</span><span class="nx">length</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="p">})</span> <span class="o">+</span> <span class="s2">&quot;C\n\n&quot;</span><span class="p">;</span>
  <span class="p">});</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-97" id="section-97">&#182;</a>
</div>
<p>Once we're done with that, now we can move on to highlighting the code we've extracted</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">this</span><span class="p">.</span><span class="nx">highlighExtractedCode</span><span class="p">(</span><span class="nx">html</span><span class="p">,</span> <span class="nx">codeBlocks</span><span class="p">,</span> <span class="nx">cb</span><span class="p">);</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="docker.prototype.highlightextractedcode">
  <h2>
    <a href="#docker.prototype.highlightextractedcode" class="pilcrow">&#182;</a>
    Docker.prototype.highlightExtractedCode
  </h2>
</div>

  </div>
  <div class="body"><p>Loops through all extracted code blocks and feeds them through pygments
for code highlighting. Unfortunately the only way to do this that's able
to cater for all situations is to spawn a new pygments process for each
code block (as different blocks might be in different languages). If anyone
knows of a more efficient way of doing this, please let me know.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">html</span>
      <span class="dox_type">string</span>
      <span>The HTML the code has been extracted from</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">codeBlocks</span>
      <span class="dox_type">Array</span>
      <span>Array of extracted code blocks as above</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">cb</span>
      <span class="dox_type">function</span>
      <span>Callback to fire when we're done with processed HTML</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">Docker</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">highlighExtractedCode</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">html</span><span class="p">,</span> <span class="nx">codeBlocks</span><span class="p">,</span> <span class="nx">cb</span><span class="p">){</span>

  <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

  <span class="kd">function</span> <span class="nx">next</span><span class="p">(){</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-99" id="section-99">&#182;</a>
</div>
<p>If we're done, then stop and fire the callback</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">if</span><span class="p">(</span><span class="nx">codeBlocks</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span><span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="nx">html</span><span class="p">);</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-100" id="section-100">&#182;</a>
</div>
<p>Pull the next code block off the beginning of the array</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="kd">var</span> <span class="nx">nextBlock</span> <span class="o">=</span> <span class="nx">codeBlocks</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-101" id="section-101">&#182;</a>
</div>
<p>Run the code through pygments</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">self</span><span class="p">.</span><span class="nx">pygments</span><span class="p">(</span><span class="nx">nextBlock</span><span class="p">.</span><span class="nx">code</span><span class="p">,</span> <span class="nx">nextBlock</span><span class="p">.</span><span class="nx">language</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">out</span><span class="p">){</span>
      <span class="nx">out</span> <span class="o">=</span> <span class="nx">out</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&lt;pre&gt;/</span><span class="p">,</span><span class="s1">&#39;&lt;pre&gt;&lt;code&gt;&#39;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&lt;\/pre&gt;/</span><span class="p">,</span><span class="s1">&#39;&lt;/code&gt;&lt;/pre&gt;&#39;</span><span class="p">);</span>
      <span class="nx">html</span> <span class="o">=</span> <span class="nx">html</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;\n~C&#39;</span> <span class="o">+</span> <span class="nx">nextBlock</span><span class="p">.</span><span class="nx">i</span> <span class="o">+</span> <span class="s1">&#39;C\n&#39;</span><span class="p">,</span> <span class="nx">out</span><span class="p">);</span>
      <span class="nx">next</span><span class="p">();</span>
    <span class="p">});</span>
  <span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-102" id="section-102">&#182;</a>
</div>
<p>Fire off on first block</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nx">next</span><span class="p">();</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="docker.prototype.addanchors">
  <h2>
    <a href="#docker.prototype.addanchors" class="pilcrow">&#182;</a>
    Docker.prototype.addAnchors
  </h2>
</div>

  </div>
  <div class="body"><p>Automatically assign an id to each section based on any headings.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">section</span>
      <span class="dox_type">object</span>
      <span>The section object to look at</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">idx</span>
      <span class="dox_type">number</span>
      <span>The index of the section in the whole array.</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">Docker</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">addAnchors</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">docHtml</span><span class="p">,</span> <span class="nx">idx</span><span class="p">,</span> <span class="nx">headings</span><span class="p">){</span>
  <span class="k">if</span><span class="p">(</span><span class="nx">docHtml</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/&lt;h[0-9]&gt;/</span><span class="p">)){</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-104" id="section-104">&#182;</a>
</div>
<p>If there is a heading tag, pick out the first one (likely the most important), sanitize
the name a bit to make it more friendly for IDs, then use that</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">docHtml</span> <span class="o">=</span> <span class="nx">docHtml</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/(&lt;h([0-9])&gt;)(.*)(&lt;\/h\2&gt;)/g</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">start</span><span class="p">,</span> <span class="nx">level</span><span class="p">,</span> <span class="nx">middle</span><span class="p">,</span> <span class="nx">end</span><span class="p">){</span>
      <span class="kd">var</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">middle</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&lt;[^&gt;]*&gt;/g</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">).</span><span class="nx">toLowerCase</span><span class="p">().</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/[^a-zA-Z0-9\_\.]/g</span><span class="p">,</span><span class="s1">&#39;-&#39;</span><span class="p">);</span>
      <span class="nx">headings</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span> <span class="nx">id</span><span class="o">:</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">text</span><span class="o">:</span> <span class="nx">middle</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&lt;[^&gt;]*&gt;/g</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">),</span> <span class="nx">level</span><span class="o">:</span> <span class="nx">level</span> <span class="p">});</span>
      <span class="k">return</span> <span class="s1">&#39;\n&lt;div class=&quot;pilwrap&quot; id=&quot;&#39;</span> <span class="o">+</span> <span class="nx">id</span> <span class="o">+</span> <span class="s1">&#39;&quot;&gt;\n  &#39;</span><span class="o">+</span>
                <span class="nx">start</span> <span class="o">+</span>
                <span class="s1">&#39;\n    &lt;a href=&quot;#&#39;</span> <span class="o">+</span> <span class="nx">id</span> <span class="o">+</span> <span class="s1">&#39;&quot; class=&quot;pilcrow&quot;&gt;&amp;#182;&lt;/a&gt;\n    &#39;</span> <span class="o">+</span>
                <span class="nx">middle</span> <span class="o">+</span> <span class="s1">&#39;\n  &#39;</span> <span class="o">+</span>
                <span class="nx">end</span> <span class="o">+</span>
              <span class="s1">&#39;\n&lt;/div&gt;\n&#39;</span><span class="p">;</span>
    <span class="p">});</span>
  <span class="p">}</span><span class="k">else</span><span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-105" id="section-105">&#182;</a>
</div>
<p>If however we can't find a heading, then just use the section index instead.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">docHtml</span> <span class="o">=</span> <span class="s1">&#39;\n&lt;div class=&quot;pilwrap&quot;&gt;&#39;</span> <span class="o">+</span>
              <span class="s1">&#39;\n  &lt;a class=&quot;pilcrow&quot; href=&quot;#section-&#39;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span> <span class="s1">&#39;&quot; id=&quot;section-&#39;</span> <span class="o">+</span><span class="p">(</span><span class="nx">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span><span class="s1">&#39;&quot;&gt;&amp;#182;&lt;/a&gt;&#39;</span> <span class="o">+</span>
              <span class="s1">&#39;\n&lt;/div&gt;\n&#39;</span> <span class="o">+</span> <span class="nx">docHtml</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">docHtml</span><span class="p">;</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="docker.prototype.addlinenumbers">
  <h2>
    <a href="#docker.prototype.addlinenumbers" class="pilcrow">&#182;</a>
    Docker.prototype.addLineNumbers
  </h2>
</div>

  </div>
  <div class="body"><p>Adds line numbers to rendered code HTML</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">html</span>
      <span class="dox_type">string</span>
      <span>The code HTML</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">first</span>
      <span class="dox_type">number</span>
      <span>Line number of the first code line</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">Docker</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">addLineNumbers</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">html</span><span class="p">,</span> <span class="nx">first</span><span class="p">){</span>
  <span class="nx">html</span> <span class="o">=</span> <span class="nx">html</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;/</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
  <span class="nx">html</span> <span class="o">=</span> <span class="nx">html</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&lt;\/pre&gt;&lt;\/div&gt;$/</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>

  <span class="kd">var</span> <span class="nx">lines</span> <span class="o">=</span> <span class="nx">html</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;\n&#39;</span><span class="p">);</span>

  <span class="kd">var</span> <span class="nx">out</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="kd">var</span> <span class="nx">line</span> <span class="o">=</span> <span class="nx">first</span><span class="p">;</span>

  <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">lines</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">){</span>
    <span class="nx">out</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;&lt;a class=&quot;line-num&quot; href=&quot;#line-&#39;</span> <span class="o">+</span> <span class="nx">line</span> <span class="o">+</span> <span class="s1">&#39;&quot; id=&quot;line-&#39;</span> <span class="o">+</span> <span class="nx">line</span> <span class="o">+</span> <span class="s1">&#39;&quot;&gt;&#39;</span> <span class="o">+</span> <span class="nx">line</span> <span class="o">+</span> <span class="s1">&#39;&lt;/a&gt;  &#39;</span> <span class="o">+</span> <span class="nx">lines</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>

    <span class="nx">line</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="s1">&#39;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&#39;</span> <span class="o">+</span> <span class="nx">out</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;\n&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&lt;/pre&gt;&lt;/div&gt;&#39;</span><span class="p">;</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="docker.prototype.rendercodehtml">
  <h2>
    <a href="#docker.prototype.rendercodehtml" class="pilcrow">&#182;</a>
    Docker.prototype.renderCodeHtml
  </h2>
</div>

  </div>
  <div class="body"><p>Given an array of sections, render them all out to a nice HTML file</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">sections</span>
      <span class="dox_type">Array</span>
      <span>Array of sections containing parsed data</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">filename</span>
      <span class="dox_type">string</span>
      <span>Name of the file being processed</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">cb</span>
      <span class="dox_type">function</span>
      <span>Callback function to fire when we're done</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">Docker</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">renderCodeHtml</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">sections</span><span class="p">,</span> <span class="nx">filename</span><span class="p">,</span> <span class="nx">cb</span><span class="p">){</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-108" id="section-108">&#182;</a>
</div>
<p>Decide which path to store the output on.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="kd">var</span> <span class="nx">outFile</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">outFile</span><span class="p">(</span><span class="nx">filename</span><span class="p">);</span>

  <span class="kd">var</span> <span class="nx">headings</span> <span class="o">=</span> <span class="p">[];</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-109" id="section-109">&#182;</a>
</div>
<p>Calculate the location of the input root relative to the output file.
This is necessary so we can link to the stylesheet in the output HTML using
a relative href rather than an absolute one</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="kd">var</span> <span class="nx">outDir</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">dirname</span><span class="p">(</span><span class="nx">outFile</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">pathSeparator</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/(^.*a|b.*$)/g</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">relativeOut</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">outDir</span><span class="p">)</span>
                    <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">outDir</span><span class="p">),</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                    <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^[\/\\]/</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">levels</span> <span class="o">=</span> <span class="nx">relativeOut</span> <span class="o">===</span> <span class="s1">&#39;&#39;</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="nx">relativeOut</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="nx">pathSeparator</span><span class="p">).</span><span class="nx">length</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">relDir</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">(</span><span class="nx">levels</span> <span class="o">+</span> <span class="mi">1</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;../&#39;</span><span class="p">);</span>

  <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">sections</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">){</span>
    <span class="nx">sections</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">docHtml</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">addAnchors</span><span class="p">(</span><span class="nx">sections</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">docHtml</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">headings</span><span class="p">);</span>

    <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">lineNums</span><span class="p">)</span> <span class="nx">sections</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">codeHtml</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">addLineNumbers</span><span class="p">(</span><span class="nx">sections</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">codeHtml</span><span class="p">,</span> <span class="nx">sections</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">firstCodeLine</span><span class="p">);</span>
  <span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-110" id="section-110">&#182;</a>
</div>
<p>Render the html file using our template</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="kd">var</span> <span class="nx">content</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">codeFileTemplate</span><span class="p">({</span>
    <span class="nx">title</span><span class="o">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">basename</span><span class="p">(</span><span class="nx">filename</span><span class="p">),</span>
    <span class="nx">sections</span><span class="o">:</span> <span class="nx">sections</span>
  <span class="p">});</span>
  <span class="kd">var</span> <span class="nx">html</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">renderTemplate</span><span class="p">({</span>
    <span class="nx">title</span><span class="o">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">basename</span><span class="p">(</span><span class="nx">filename</span><span class="p">),</span>
    <span class="nx">relativeDir</span><span class="o">:</span> <span class="nx">relDir</span><span class="p">,</span>
    <span class="nx">content</span><span class="o">:</span> <span class="nx">content</span><span class="p">,</span>
    <span class="nx">headings</span><span class="o">:</span> <span class="nx">headings</span><span class="p">,</span>
    <span class="nx">sidebar</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">sidebarState</span><span class="p">,</span>
    <span class="nx">colourScheme</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">colourScheme</span><span class="p">,</span>
    <span class="nx">filename</span><span class="o">:</span> <span class="nx">filename</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">inDir</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^[\/\\]/</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">),</span>
    <span class="nx">js</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">extraJS</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">basename</span><span class="p">),</span>
    <span class="nx">css</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">extraCSS</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">basename</span><span class="p">)</span>
  <span class="p">});</span>

  <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-111" id="section-111">&#182;</a>
</div>
<p>Recursively create the output directory, clean out any old version of the
output file, then save our new file.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">this</span><span class="p">.</span><span class="nx">writeFile</span><span class="p">(</span><span class="nx">outFile</span><span class="p">,</span> <span class="nx">html</span><span class="p">,</span> <span class="s1">&#39;Generated: &#39;</span> <span class="o">+</span> <span class="nx">outFile</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">outDir</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">),</span> <span class="nx">cb</span><span class="p">);</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="docker.prototype.rendermarkdownhtml">
  <h2>
    <a href="#docker.prototype.rendermarkdownhtml" class="pilcrow">&#182;</a>
    Docker.prototype.renderMarkdownHtml
  </h2>
</div>

  </div>
  <div class="body"><p>Renders the output for a Markdown file into HTML</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">content</span>
      <span class="dox_type">string</span>
      <span>The markdown file content</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">filename</span>
      <span class="dox_type">string</span>
      <span>Name of the file being processed</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">cb</span>
      <span class="dox_type">function</span>
      <span>Callback function to fire when we're done</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">Docker</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">renderMarkdownHtml</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">content</span><span class="p">,</span> <span class="nx">filename</span><span class="p">,</span> <span class="nx">cb</span><span class="p">){</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-113" id="section-113">&#182;</a>
</div>
<p>Run the markdown through <em>showdown</em></p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nx">content</span> <span class="o">=</span> <span class="nx">showdown</span><span class="p">.</span><span class="nx">makeHtml</span><span class="p">(</span><span class="nx">content</span><span class="p">);</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">extractDocCode</span><span class="p">(</span><span class="nx">content</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">content</span><span class="p">){</span>

    <span class="kd">var</span> <span class="nx">headings</span> <span class="o">=</span> <span class="p">[];</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-114" id="section-114">&#182;</a>
</div>
<p>Add anchors to all headings</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">content</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">addAnchors</span><span class="p">(</span><span class="nx">content</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="nx">headings</span><span class="p">);</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-115" id="section-115">&#182;</a>
</div>
<p>Wrap up with necessary classes</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">content</span> <span class="o">=</span> <span class="s1">&#39;&lt;div class=&quot;docs markdown&quot;&gt;&#39;</span> <span class="o">+</span> <span class="nx">content</span> <span class="o">+</span> <span class="s1">&#39;&lt;/div&gt;&#39;</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-116" id="section-116">&#182;</a>
</div>
<p>Decide which path to store the output on.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="kd">var</span> <span class="nx">outFile</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">outFile</span><span class="p">(</span><span class="nx">filename</span><span class="p">);</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-117" id="section-117">&#182;</a>
</div>
<p>Calculate the location of the input root relative to the output file.
This is necessary so we can link to the stylesheet in the output HTML using
a relative href rather than an absolute one</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="kd">var</span> <span class="nx">outDir</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">dirname</span><span class="p">(</span><span class="nx">outFile</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">pathSeparator</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/(^.*a|b.*$)/g</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">relativeOut</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">outDir</span><span class="p">)</span>
                      <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">outDir</span><span class="p">),</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                      <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^[\/\\]/</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">levels</span> <span class="o">=</span> <span class="nx">relativeOut</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="nx">relativeOut</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="nx">pathSeparator</span><span class="p">).</span><span class="nx">length</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">relDir</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">(</span><span class="nx">levels</span> <span class="o">+</span> <span class="mi">1</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;../&#39;</span><span class="p">);</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-118" id="section-118">&#182;</a>
</div>
<p>Render the html file using our template</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="kd">var</span> <span class="nx">html</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">renderTemplate</span><span class="p">({</span>
      <span class="nx">title</span><span class="o">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">basename</span><span class="p">(</span><span class="nx">filename</span><span class="p">),</span>
      <span class="nx">relativeDir</span><span class="o">:</span> <span class="nx">relDir</span><span class="p">,</span>
      <span class="nx">content</span><span class="o">:</span> <span class="nx">content</span><span class="p">,</span>
      <span class="nx">headings</span><span class="o">:</span> <span class="nx">headings</span><span class="p">,</span>
      <span class="nx">colourScheme</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">colourScheme</span><span class="p">,</span>
      <span class="nx">sidebar</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">sidebarState</span><span class="p">,</span>
      <span class="nx">filename</span><span class="o">:</span> <span class="nx">filename</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">inDir</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^[\\\/]/</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">),</span>
      <span class="nx">js</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">extraJS</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">basename</span><span class="p">),</span>
      <span class="nx">css</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">extraCSS</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">basename</span><span class="p">)</span>
    <span class="p">});</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-119" id="section-119">&#182;</a>
</div>
<p>Recursively create the output directory, clean out any old version of the
output file, then save our new file.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">this</span><span class="p">.</span><span class="nx">writeFile</span><span class="p">(</span><span class="nx">outFile</span><span class="p">,</span> <span class="nx">html</span><span class="p">,</span> <span class="s1">&#39;Generated: &#39;</span> <span class="o">+</span> <span class="nx">outFile</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">outDir</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">),</span> <span class="nx">cb</span><span class="p">);</span>
  <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="docker.prototype.copysharedresources">
  <h2>
    <a href="#docker.prototype.copysharedresources" class="pilcrow">&#182;</a>
    Docker.prototype.copySharedResources
  </h2>
</div>

  </div>
  <div class="body"><p>Copies the shared CSS and JS files to the output directories</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">Docker</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">copySharedResources</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
  <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">toDo</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
  <span class="kd">function</span> <span class="nx">done</span><span class="p">(){</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!--</span><span class="nx">toDo</span><span class="p">){</span>
      <span class="nx">self</span><span class="p">.</span><span class="nx">finished</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nx">fs</span><span class="p">.</span><span class="nx">readFile</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">dirname</span><span class="p">(</span><span class="nx">__filename</span><span class="p">),</span><span class="s1">&#39;..&#39;</span><span class="p">,</span><span class="s1">&#39;res&#39;</span><span class="p">,</span><span class="s1">&#39;script.js&#39;</span><span class="p">),</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">file</span><span class="p">){</span>
    <span class="nx">self</span><span class="p">.</span><span class="nx">writeFileIfDifferent</span><span class="p">(</span>
      <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">outDir</span><span class="p">,</span> <span class="s1">&#39;doc-script.js&#39;</span><span class="p">),</span>
      <span class="nx">file</span><span class="p">,</span>
      <span class="s1">&#39;Copied JS to doc-script.js&#39;</span><span class="p">,</span>
      <span class="nx">done</span>
    <span class="p">);</span>
  <span class="p">});</span>

  <span class="nx">fs</span><span class="p">.</span><span class="nx">readFile</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">dirname</span><span class="p">(</span><span class="nx">__filename</span><span class="p">),</span><span class="s1">&#39;..&#39;</span><span class="p">,</span><span class="s1">&#39;res&#39;</span><span class="p">,</span><span class="s1">&#39;css&#39;</span><span class="p">,</span> <span class="nx">self</span><span class="p">.</span><span class="nx">colourScheme</span> <span class="o">+</span> <span class="s1">&#39;.css&#39;</span><span class="p">),</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">file</span><span class="p">){</span>
    <span class="nx">exec</span><span class="p">(</span><span class="s1">&#39;pygmentize -S &#39;</span> <span class="o">+</span> <span class="nx">self</span><span class="p">.</span><span class="nx">colourScheme</span> <span class="o">+</span> <span class="s1">&#39; -f html -a &quot;body .highlight&quot;&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">code</span><span class="p">,</span> <span class="nx">stdout</span><span class="p">,</span> <span class="nx">stderr</span><span class="p">){</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">code</span> <span class="o">||</span> <span class="nx">stderr</span> <span class="o">!==</span> <span class="s1">&#39;&#39;</span><span class="p">){</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Error generating CSS: \n&#39;</span> <span class="o">+</span> <span class="nx">stderr</span><span class="p">);</span>
        <span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">();</span>
      <span class="p">}</span>
      <span class="nx">self</span><span class="p">.</span><span class="nx">writeFileIfDifferent</span><span class="p">(</span>
        <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">outDir</span><span class="p">,</span> <span class="s1">&#39;doc-style.css&#39;</span><span class="p">),</span>
        <span class="nx">file</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span> <span class="o">+</span> <span class="nx">stdout</span><span class="p">,</span>
        <span class="s1">&#39;Copied &#39;</span> <span class="o">+</span> <span class="nx">self</span><span class="p">.</span><span class="nx">colourScheme</span> <span class="o">+</span> <span class="s1">&#39;.css to doc-style.css&#39;</span><span class="p">,</span>
        <span class="nx">done</span>
      <span class="p">);</span>
    <span class="p">});</span>
  <span class="p">});</span>

  <span class="nx">self</span><span class="p">.</span><span class="nx">writeFileIfDifferent</span><span class="p">(</span>
    <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">outDir</span><span class="p">,</span> <span class="s1">&#39;doc-filelist.js&#39;</span><span class="p">),</span>
    <span class="s1">&#39;var tree=&#39;</span> <span class="o">+</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">tree</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;;&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Saved file tree to doc-filelist.js&#39;</span><span class="p">,</span>
    <span class="nx">done</span>
  <span class="p">);</span>

  <span class="kd">var</span> <span class="nx">extras</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">extraJS</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">extraCSS</span><span class="p">);</span>

  <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">extras</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">){</span>
    <span class="nx">toDo</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="nx">self</span><span class="p">.</span><span class="nx">copyExtraFile</span><span class="p">(</span><span class="nx">extras</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">done</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="docker.prototype.copyextrafile">
  <h2>
    <a href="#docker.prototype.copyextrafile" class="pilcrow">&#182;</a>
    Docker.prototype.copyExtraFile
  </h2>
</div>

  </div>
  <div class="body"><p>Copies an additional JS or CSS file to the output</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">filename</span>
      <span class="dox_type">string</span>
      <span>Path (relative to pwd) to the file</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">cb</span>
      <span class="dox_type">function</span>
      <span>Callback to fire when done</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">Docker</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">copyExtraFile</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">filename</span><span class="p">,</span> <span class="nx">cb</span><span class="p">){</span>
  <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">fn</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">basename</span><span class="p">(</span><span class="nx">filename</span><span class="p">);</span>
  <span class="nx">fs</span><span class="p">.</span><span class="nx">readFile</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">filename</span><span class="p">),</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">file</span><span class="p">){</span>
    <span class="nx">self</span><span class="p">.</span><span class="nx">writeFileIfDifferent</span><span class="p">(</span>
      <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">outDir</span><span class="p">,</span> <span class="nx">fn</span><span class="p">),</span>
      <span class="nx">file</span><span class="p">,</span>
      <span class="s1">&#39;Copied &#39;</span> <span class="o">+</span> <span class="nx">fn</span><span class="p">,</span>
      <span class="nx">cb</span>
    <span class="p">);</span>
  <span class="p">});</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="docker.prototype.outfile">
  <h2>
    <a href="#docker.prototype.outfile" class="pilcrow">&#182;</a>
    Docker.prototype.outFile
  </h2>
</div>

  </div>
  <div class="body"><p>Generates the output path for a given input file</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">filename</span>
      <span class="dox_type">string</span>
      <span>Name of the input file</span>
    </div>
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">string</span>
      <span>Name to use for the generated doc file</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">Docker</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">outFile</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">filename</span><span class="p">){</span>

  <span class="k">return</span> <span class="nx">path</span><span class="p">.</span><span class="nx">normalize</span><span class="p">(</span><span class="nx">filename</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">inDir</span><span class="p">),</span> <span class="k">this</span><span class="p">.</span><span class="nx">outDir</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.html&#39;</span><span class="p">);</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="docker.prototype.compiletemplate">
  <h2>
    <a href="#docker.prototype.compiletemplate" class="pilcrow">&#182;</a>
    Docker.prototype.compileTemplate
  </h2>
</div>

  </div>
  <div class="body"><p>Tiny template compilation function</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">str</span>
      <span class="dox_type">string</span>
      <span>Template content</span>
    </div>
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">function</span>
      <span>Compiled template function</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">Docker</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">compileTemplate</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">str</span><span class="p">){</span>
  <span class="k">return</span> <span class="k">new</span> <span class="nb">Function</span><span class="p">(</span><span class="s1">&#39;obj&#39;</span><span class="p">,</span> <span class="s1">&#39;var p=[],print=function(){p.push.apply(p,arguments);};&#39;</span> <span class="o">+</span>
    <span class="s1">&#39;with(obj){p.push(\&#39;&#39;</span> <span class="o">+</span>
    <span class="nx">str</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/[\r\t]/g</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>
       <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/(&gt;)\s*\n+(\s*&lt;)/g</span><span class="p">,</span><span class="s1">&#39;$1\n$2&#39;</span><span class="p">)</span>
       <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/(?=&lt;%[^=][^%]*)%&gt;\s*\n*\s*&lt;%(?=[^=])/g</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
       <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/%&gt;\s*(?=\n)/g</span><span class="p">,</span><span class="s1">&#39;%&gt;&#39;</span><span class="p">)</span>
       <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/(?=\n)\s*&lt;%/g</span><span class="p">,</span><span class="s1">&#39;&lt;%&#39;</span><span class="p">)</span>
       <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\n/g</span><span class="p">,</span><span class="s2">&quot;~K&quot;</span><span class="p">)</span>
       <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/~K(?=[^%]*%&gt;)/g</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>
       <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/~K/g</span><span class="p">,</span> <span class="s1">&#39;\\n&#39;</span><span class="p">)</span>
       <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&#39;(?=[^%]*%&gt;)/g</span><span class="p">,</span> <span class="s2">&quot;\t&quot;</span><span class="p">)</span>
       <span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;\\&#39;&quot;</span><span class="p">)</span>
       <span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot;\t&quot;</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">)</span>
       <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&lt;%=(.+?)%&gt;/g</span><span class="p">,</span> <span class="s2">&quot;&#39;,$1,&#39;&quot;</span><span class="p">)</span>
       <span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;&lt;%&#39;</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;&#39;);&quot;</span><span class="p">)</span>
       <span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;%&gt;&#39;</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;p.push(&#39;&quot;</span><span class="p">)</span> <span class="o">+</span>
    <span class="s2">&quot;&#39;);}return p.join(&#39;&#39;);&quot;</span><span class="p">);</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="docker.prototype.rendertemplate">
  <h2>
    <a href="#docker.prototype.rendertemplate" class="pilcrow">&#182;</a>
    Docker.prototype.renderTemplate
  </h2>
</div>

  </div>
  <div class="body"><p>Renders the HTML for an output page with given parameters</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">obj</span>
      <span class="dox_type">object</span>
      <span>Object containing parameters for the template</span>
    </div>
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">string</span>
      <span>Rendered doc page</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">Docker</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">renderTemplate</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">){</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-125" id="section-125">&#182;</a>
</div>
<p>If we haven't already loaded the template, load it now.
It's a bit messy to be using readFileSync I know, but this
is the easiest way for now.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">__tmpl</span><span class="p">){</span>
    <span class="kd">var</span> <span class="nx">tmplFile</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">dirname</span><span class="p">(</span><span class="nx">__filename</span><span class="p">),</span><span class="s1">&#39;..&#39;</span><span class="p">,</span><span class="s1">&#39;res&#39;</span><span class="p">,</span><span class="s1">&#39;tmpl.jst&#39;</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">__tmpl</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">compileTemplate</span><span class="p">(</span><span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="nx">tmplFile</span><span class="p">).</span><span class="nx">toString</span><span class="p">());</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">__tmpl</span><span class="p">(</span><span class="nx">obj</span><span class="p">);</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="docker.prototype.codefiletemplate">
  <h2>
    <a href="#docker.prototype.codefiletemplate" class="pilcrow">&#182;</a>
    Docker.prototype.codeFileTemplate
  </h2>
</div>

  </div>
  <div class="body"><p>Renders the content for a code file's doc page</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">obj</span>
      <span class="dox_type">object</span>
      <span>Object containing parameters for the template</span>
    </div>
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">string</span>
      <span>Rendered content</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">Docker</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">codeFileTemplate</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">){</span>
  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">__codeTmpl</span><span class="p">){</span>
    <span class="kd">var</span> <span class="nx">tmplFile</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">dirname</span><span class="p">(</span><span class="nx">__filename</span><span class="p">),</span><span class="s1">&#39;..&#39;</span><span class="p">,</span><span class="s1">&#39;res&#39;</span><span class="p">,</span><span class="s1">&#39;code.jst&#39;</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">__codeTmpl</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">compileTemplate</span><span class="p">(</span><span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="nx">tmplFile</span><span class="p">).</span><span class="nx">toString</span><span class="p">());</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">__codeTmpl</span><span class="p">(</span><span class="nx">obj</span><span class="p">);</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="docker.prototype.jsdoctemplate">
  <h2>
    <a href="#docker.prototype.jsdoctemplate" class="pilcrow">&#182;</a>
    Docker.prototype.jsDocTemplate
  </h2>
</div>

  </div>
  <div class="body"><p>Renders parsed multiline commend data into a format suitable for compilation</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">obj</span>
      <span class="dox_type">object</span>
      <span>Object containing parsed multiline comment data</span>
    </div>
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">string</span>
      <span>Rendered output of comment properties</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">Docker</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">jsDocTemplate</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">){</span>
  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">__jsdoctmpl</span><span class="p">){</span>
    <span class="kd">var</span> <span class="nx">tmplFile</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">dirname</span><span class="p">(</span><span class="nx">__filename</span><span class="p">),</span> <span class="s1">&#39;..&#39;</span><span class="p">,</span><span class="s1">&#39;res&#39;</span><span class="p">,</span><span class="s1">&#39;jsDoc.jst&#39;</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">__jsdoctmpl</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">compileTemplate</span><span class="p">(</span><span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="nx">tmplFile</span><span class="p">).</span><span class="nx">toString</span><span class="p">());</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">__jsdoctmpl</span><span class="p">(</span><span class="nx">obj</span><span class="p">);</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="docker.prototype.writefile">
  <h2>
    <a href="#docker.prototype.writefile" class="pilcrow">&#182;</a>
    Docker.prototype.writeFile
  </h2>
</div>

  </div>
  <div class="body"><p>Saves a file, making sure the directory already exists and overwriting any existing file</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">filename</span>
      <span class="dox_type">string</span>
      <span>The name of the file to save</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">fileContent</span>
      <span class="dox_type">string</span>
      <span>Content to save to the file</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">doneLog</span>
      <span class="dox_type">string</span>
      <span>String to console.log when done</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">doneCallback</span>
      <span class="dox_type">function</span>
      <span>Callback to fire when done</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">Docker</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">writeFile</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">filename</span><span class="p">,</span> <span class="nx">fileContent</span><span class="p">,</span> <span class="nx">doneLog</span><span class="p">,</span> <span class="nx">doneCallback</span><span class="p">){</span>
  <span class="kd">var</span> <span class="nx">outDir</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">dirname</span><span class="p">(</span><span class="nx">filename</span><span class="p">);</span>
  <span class="nx">mkdirp</span><span class="p">(</span><span class="nx">outDir</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="nx">fs</span><span class="p">.</span><span class="nx">unlink</span><span class="p">(</span><span class="nx">filename</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
      <span class="nx">fs</span><span class="p">.</span><span class="nx">writeFile</span><span class="p">(</span><span class="nx">filename</span><span class="p">,</span> <span class="nx">fileContent</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">doneLog</span><span class="p">)</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">doneLog</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">doneCallback</span><span class="p">)</span> <span class="nx">doneCallback</span><span class="p">();</span>
      <span class="p">});</span>
    <span class="p">});</span>
  <span class="p">});</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="docker.prototype.writefileifdifferent">
  <h2>
    <a href="#docker.prototype.writefileifdifferent" class="pilcrow">&#182;</a>
    Docker.prototype.writeFileIfDifferent
  </h2>
</div>

  </div>
  <div class="body"><p>Saves a fileas above, but only if the file's contents are to be changed</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">filename</span>
      <span class="dox_type">string</span>
      <span>The name of the file to save</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">fileContent</span>
      <span class="dox_type">string</span>
      <span>Content to save to the file</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">doneLog</span>
      <span class="dox_type">string</span>
      <span>String to console.log when done</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">doneCallback</span>
      <span class="dox_type">function</span>
      <span>Callback to fire when done</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">Docker</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">writeFileIfDifferent</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">filename</span><span class="p">,</span> <span class="nx">fileContent</span><span class="p">,</span> <span class="nx">doneLog</span><span class="p">,</span> <span class="nx">doneCallback</span><span class="p">){</span>
  <span class="kd">var</span> <span class="nx">outDir</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">dirname</span><span class="p">(</span><span class="nx">filename</span><span class="p">);</span>
  <span class="nx">fs</span><span class="p">.</span><span class="nx">readFile</span><span class="p">(</span><span class="nx">filename</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">content</span><span class="p">){</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">err</span> <span class="o">&amp;&amp;</span> <span class="nx">content</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span> <span class="o">===</span> <span class="nx">fileContent</span><span class="p">.</span><span class="nx">toString</span><span class="p">()){</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">doneCallback</span><span class="p">)</span> <span class="nx">doneCallback</span><span class="p">();</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">mkdirp</span><span class="p">(</span><span class="nx">outDir</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
      <span class="nx">fs</span><span class="p">.</span><span class="nx">unlink</span><span class="p">(</span><span class="nx">filename</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
        <span class="nx">fs</span><span class="p">.</span><span class="nx">writeFile</span><span class="p">(</span><span class="nx">filename</span><span class="p">,</span> <span class="nx">fileContent</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
          <span class="k">if</span><span class="p">(</span><span class="nx">doneLog</span><span class="p">)</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">doneLog</span><span class="p">);</span>
          <span class="k">if</span><span class="p">(</span><span class="nx">doneCallback</span><span class="p">)</span> <span class="nx">doneCallback</span><span class="p">();</span>
        <span class="p">});</span>
      <span class="p">});</span>
    <span class="p">});</span>
  <span class="p">});</span>
<span class="p">};</span>
</pre></div>
        </td>
      </tr>
  </tbody>
</table>
  </div>
</body>
</html>
