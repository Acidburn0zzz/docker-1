<!DOCTYPE html>
<html>
<head>
  <title>README.md</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../../../../../doc-style.css" />
  <script src="../../../../../../doc-filelist.js"></script>
  <script>
    var relativeDir = '../../../../../../', thisFile = 'node_modules/watchr/node_modules/bal-util/node_modules/request/README.md';
  </script>
  <script src="../../../../../../doc-script.js"></script>
</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">
      <div class="heading h1">
        <a href="#request----simplified-http-request-method">Request -- Simplified HTTP request method</a>
      </div>
      <div class="heading h2">
        <a href="#install">Install</a>
      </div>
      <div class="heading h2">
        <a href="#super-simple-to-use">Super simple to use</a>
      </div>
      <div class="heading h2">
        <a href="#streaming">Streaming</a>
      </div>
      <div class="heading h2">
        <a href="#oauth-signing">OAuth Signing</a>
      </div>
      <div class="heading h3">
        <a href="#request-options--callback-">request(options, callback)</a>
      </div>
      <div class="heading h2">
        <a href="#convenience-methods">Convenience methods</a>
      </div>
      <div class="heading h3">
        <a href="#request.defaults-options-">request.defaults(options)</a>
      </div>
      <div class="heading h3">
        <a href="#request.put">request.put</a>
      </div>
      <div class="heading h3">
        <a href="#request.post">request.post</a>
      </div>
      <div class="heading h3">
        <a href="#request.head">request.head</a>
      </div>
      <div class="heading h3">
        <a href="#request.del">request.del</a>
      </div>
      <div class="heading h3">
        <a href="#request.get">request.get</a>
      </div>
      <div class="heading h3">
        <a href="#request.cookie">request.cookie</a>
      </div>
      <div class="heading h3">
        <a href="#request.jar">request.jar</a>
      </div>
      <div class="heading h2">
        <a href="#examples-">Examples:</a>
      </div>
    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container"><div class="docs markdown">
<div class="pilwrap" id="request----simplified-http-request-method">
  <h1>
    <a href="#request----simplified-http-request-method" class="pilcrow">&#182;</a>
    Request -- Simplified HTTP request method
  </h1>
</div>



<div class="pilwrap" id="install">
  <h2>
    <a href="#install" class="pilcrow">&#182;</a>
    Install
  </h2>
</div>


<pre>
  npm install request
</pre>

<p>Or from source:</p>

<pre>
  git clone git://github.com/mikeal/request.git 
  cd request
  npm link
</pre>


<div class="pilwrap" id="super-simple-to-use">
  <h2>
    <a href="#super-simple-to-use" class="pilcrow">&#182;</a>
    Super simple to use
  </h2>
</div>


<p>Request is designed to be the simplest way possible to make http calls. It support HTTPS and follows redirects by default.</p>


<div class="highlight"><pre><code><span class="kd">var</span> <span class="nx">request</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;request&#39;</span><span class="p">);</span>
<span class="nx">request</span><span class="p">(</span><span class="s1">&#39;http://www.google.com&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">response</span><span class="p">,</span> <span class="nx">body</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">error</span> <span class="o">&amp;&amp;</span><span class="nx">amp</span><span class="p">;</span> <span class="nx">response</span><span class="p">.</span><span class="nx">statusCode</span> <span class="o">==</span> <span class="mi">200</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">body</span><span class="p">)</span> <span class="c1">// Print the google web page.</span>
  <span class="p">}</span>
<span class="p">})</span>
</code></pre></div>




<div class="pilwrap" id="streaming">
  <h2>
    <a href="#streaming" class="pilcrow">&#182;</a>
    Streaming
  </h2>
</div>


<p>You can stream any response to a file stream.</p>


<div class="highlight"><pre><code><span class="nx">request</span><span class="p">(</span><span class="s1">&#39;http://google.com/doodle.png&#39;</span><span class="p">).</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">fs</span><span class="p">.</span><span class="nx">createWriteStream</span><span class="p">(</span><span class="s1">&#39;doodle.png&#39;</span><span class="p">))</span>
</code></pre></div>



<p>You can also stream a file to a PUT or POST request. This method will also check the file extension against a mapping of file extensions to content-types, in this case <code>application/json</code>, and use the proper content-type in the PUT request if one is not already provided in the headers.</p>


<div class="highlight"><pre><code><span class="nx">fs</span><span class="p">.</span><span class="nx">createReadStream</span><span class="p">(</span><span class="s1">&#39;file.json&#39;</span><span class="p">).</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="s1">&#39;http://mysite.com/obj.json&#39;</span><span class="p">))</span>
</code></pre></div>



<p>Request can also pipe to itself. When doing so the content-type and content-length will be preserved in the PUT headers.</p>


<div class="highlight"><pre><code><span class="nx">request</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;http://google.com/img.png&#39;</span><span class="p">).</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="s1">&#39;http://mysite.com/img.png&#39;</span><span class="p">))</span>
</code></pre></div>



<p>Now let's get fancy.</p>


<div class="highlight"><pre><code><span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">resp</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">url</span> <span class="o">===</span> <span class="s1">&#39;/doodle.png&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">method</span> <span class="o">===</span> <span class="s1">&#39;PUT&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">req</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="s1">&#39;http://mysite.com/doodle.png&#39;</span><span class="p">))</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">method</span> <span class="o">===</span> <span class="s1">&#39;GET&#39;</span> <span class="o">||</span> <span class="nx">req</span><span class="p">.</span><span class="nx">method</span> <span class="o">===</span> <span class="s1">&#39;HEAD&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">request</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;http://mysite.com/doodle.png&#39;</span><span class="p">).</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">resp</span><span class="p">)</span>
    <span class="p">}</span> 
  <span class="p">}</span>
<span class="p">})</span>
</code></pre></div>



<p>You can also pipe() from a http.ServerRequest instance and to a http.ServerResponse instance. The HTTP method and headers will be sent as well as the entity-body data. Which means that, if you don't really care about security, you can do:</p>


<div class="highlight"><pre><code><span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">resp</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">url</span> <span class="o">===</span> <span class="s1">&#39;/doodle.png&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="nx">request</span><span class="p">(</span><span class="s1">&#39;http://mysite.com/doodle.png&#39;</span><span class="p">)</span>
    <span class="nx">req</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span>
    <span class="nx">x</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">resp</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">})</span>
</code></pre></div>



<p>And since pipe() returns the destination stream in node 0.5.x you can do one line proxying :)</p>


<div class="highlight"><pre><code><span class="nx">req</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">request</span><span class="p">(</span><span class="s1">&#39;http://mysite.com/doodle.png&#39;</span><span class="p">)).</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">resp</span><span class="p">)</span>
</code></pre></div>



<p>Also, none of this new functionality conflicts with requests previous features, it just expands them.</p>


<div class="highlight"><pre><code><span class="kd">var</span> <span class="nx">r</span> <span class="o">=</span> <span class="nx">request</span><span class="p">.</span><span class="nx">defaults</span><span class="p">({</span><span class="s1">&#39;proxy&#39;</span><span class="o">:</span><span class="s1">&#39;http://localproxy.com&#39;</span><span class="p">})</span>

<span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">resp</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">url</span> <span class="o">===</span> <span class="s1">&#39;/doodle.png&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">r</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;http://google.com/doodle.png&#39;</span><span class="p">).</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">resp</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">})</span>
</code></pre></div>



<p>You can still use intermediate proxies, the requests will still follow HTTP forwards, etc.</p>


<div class="pilwrap" id="oauth-signing">
  <h2>
    <a href="#oauth-signing" class="pilcrow">&#182;</a>
    OAuth Signing
  </h2>
</div>



<div class="highlight"><pre><code><span class="c1">// Twitter OAuth</span>
<span class="kd">var</span> <span class="nx">qs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;querystring&#39;</span><span class="p">)</span>
  <span class="p">,</span> <span class="nx">oauth</span> <span class="o">=</span>
    <span class="p">{</span> <span class="nx">callback</span><span class="o">:</span> <span class="s1">&#39;http://mysite.com/callback/&#39;</span>
    <span class="p">,</span> <span class="nx">consumer_key</span><span class="o">:</span> <span class="nx">CONSUMER_KEY</span>
    <span class="p">,</span> <span class="nx">consumer_secret</span><span class="o">:</span> <span class="nx">CONSUMER_SECRET</span>
    <span class="p">}</span>
  <span class="p">,</span> <span class="nx">url</span> <span class="o">=</span> <span class="s1">&#39;https://api.twitter.com/oauth/request_token&#39;</span>
  <span class="p">;</span>
<span class="nx">request</span><span class="p">.</span><span class="nx">post</span><span class="p">({</span><span class="nx">url</span><span class="o">:</span><span class="nx">url</span><span class="p">,</span> <span class="nx">oauth</span><span class="o">:</span><span class="nx">oauth</span><span class="p">},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">body</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Assume by some stretch of magic you aquired the verifier</span>
  <span class="kd">var</span> <span class="nx">access_token</span> <span class="o">=</span> <span class="nx">qs</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">body</span><span class="p">)</span>
    <span class="p">,</span> <span class="nx">oauth</span> <span class="o">=</span> 
      <span class="p">{</span> <span class="nx">consumer_key</span><span class="o">:</span> <span class="nx">CONSUMER_KEY</span>
      <span class="p">,</span> <span class="nx">consumer_secret</span><span class="o">:</span> <span class="nx">CONSUMER_SECRET</span>
      <span class="p">,</span> <span class="nx">token</span><span class="o">:</span> <span class="nx">access_token</span><span class="p">.</span><span class="nx">oauth_token</span>
      <span class="p">,</span> <span class="nx">verifier</span><span class="o">:</span> <span class="nx">VERIFIER</span>
      <span class="p">,</span> <span class="nx">token_secret</span><span class="o">:</span> <span class="nx">access_token</span><span class="p">.</span><span class="nx">oauth_token_secret</span>
      <span class="p">}</span>
    <span class="p">,</span> <span class="nx">url</span> <span class="o">=</span> <span class="s1">&#39;https://api.twitter.com/oauth/access_token&#39;</span>
    <span class="p">;</span>
  <span class="nx">request</span><span class="p">.</span><span class="nx">post</span><span class="p">({</span><span class="nx">url</span><span class="o">:</span><span class="nx">url</span><span class="p">,</span> <span class="nx">oauth</span><span class="o">:</span><span class="nx">oauth</span><span class="p">},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">body</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">perm_token</span> <span class="o">=</span> <span class="nx">qs</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">body</span><span class="p">)</span>
      <span class="p">,</span> <span class="nx">oauth</span> <span class="o">=</span> 
        <span class="p">{</span> <span class="nx">consumer_key</span><span class="o">:</span> <span class="nx">CONSUMER_KEY</span>
        <span class="p">,</span> <span class="nx">consumer_secret</span><span class="o">:</span> <span class="nx">CONSUMER_SECRET</span>
        <span class="p">,</span> <span class="nx">token</span><span class="o">:</span> <span class="nx">perm_token</span><span class="p">.</span><span class="nx">oauth_token</span>
        <span class="p">,</span> <span class="nx">token_secret</span><span class="o">:</span> <span class="nx">perm_token</span><span class="p">.</span><span class="nx">oauth_token_secret</span>
        <span class="p">}</span>
      <span class="p">,</span> <span class="nx">url</span> <span class="o">=</span> <span class="s1">&#39;https://api.twitter.com/1/users/show.json?&#39;</span>
      <span class="p">,</span> <span class="nx">params</span> <span class="o">=</span> 
        <span class="p">{</span> <span class="nx">screen_name</span><span class="o">:</span> <span class="nx">perm_token</span><span class="p">.</span><span class="nx">screen_name</span>
        <span class="p">,</span> <span class="nx">user_id</span><span class="o">:</span> <span class="nx">perm_token</span><span class="p">.</span><span class="nx">user_id</span>
        <span class="p">}</span>
      <span class="p">;</span>
    <span class="nx">url</span> <span class="o">+=</span> <span class="nx">qs</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">params</span><span class="p">)</span>
    <span class="nx">request</span><span class="p">.</span><span class="nx">get</span><span class="p">({</span><span class="nx">url</span><span class="o">:</span><span class="nx">url</span><span class="p">,</span> <span class="nx">oauth</span><span class="o">:</span><span class="nx">oauth</span><span class="p">,</span> <span class="nx">json</span><span class="o">:</span><span class="kc">true</span><span class="p">},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">user</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">user</span><span class="p">)</span>
    <span class="p">})</span>
  <span class="p">})</span>
<span class="p">})</span>
</code></pre></div>




<div class="pilwrap" id="request-options--callback-">
  <h3>
    <a href="#request-options--callback-" class="pilcrow">&#182;</a>
    request(options, callback)
  </h3>
</div>


<p>The first argument can be either a url or an options object. The only required option is uri, all others are optional.</p>

<ul>
<li><code>uri</code> || <code>url</code> - fully qualified uri or a parsed url object from url.parse()</li>
<li><code>qs</code> - object containing querystring values to be appended to the uri</li>
<li><code>method</code> - http method, defaults to GET</li>
<li><code>headers</code> - http headers, defaults to {}</li>
<li><code>body</code> - entity body for POST and PUT requests. Must be buffer or string.</li>
<li><code>form</code> - sets <code>body</code> but to querystring representation of value and adds <code>Content-type: application/x-www-form-urlencoded; charset=utf-8</code> header.</li>
<li><code>json</code> - sets <code>body</code> but to JSON representation of value and adds <code>Content-type: application/json</code> header.</li>
<li><code>multipart</code> - (experimental) array of objects which contains their own headers and <code>body</code> attribute. Sends <code>multipart/related</code> request. See example below.</li>
<li><code>followRedirect</code> - follow HTTP 3xx responses as redirects. defaults to true.</li>
<li><code>followAllRedirects</code> - follow non-GET HTTP 3xx responses as redirects. defaults to false.</li>
<li><code>maxRedirects</code> - the maximum number of redirects to follow, defaults to 10.</li>
<li><code>encoding</code> - Encoding to be used on <code>setEncoding</code> of response data. If set to <code>null</code>, the body is returned as a Buffer.</li>
<li><code>pool</code> - A hash object containing the agents for these requests. If omitted this request will use the global pool which is set to node's default maxSockets.</li>
<li><code>pool.maxSockets</code> - Integer containing the maximum amount of sockets in the pool.</li>
<li><code>timeout</code> - Integer containing the number of milliseconds to wait for a request to respond before aborting the request    </li>
<li><code>proxy</code> - An HTTP proxy to be used. Support proxy Auth with Basic Auth the same way it's supported with the <code>url</code> parameter by embedding the auth info in the uri.</li>
<li><code>oauth</code> - Options for OAuth HMAC-SHA1 signing, see documentation above.</li>
<li><code>strictSSL</code> - Set to <code>true</code> to require that SSL certificates be valid. Note: to use your own certificate authority, you need to specify an agent that was created with that ca as an option.</li>
<li><code>jar</code> - Set to <code>false</code> if you don't want cookies to be remembered for future use or define your custom cookie jar (see examples section)</li>
</ul>

<p>The callback argument gets 3 arguments. The first is an error when applicable (usually from the http.Client option not the http.ClientRequest object). The second in an http.ClientResponse object. The third is the response body String or Buffer.</p>


<div class="pilwrap" id="convenience-methods">
  <h2>
    <a href="#convenience-methods" class="pilcrow">&#182;</a>
    Convenience methods
  </h2>
</div>


<p>There are also shorthand methods for different HTTP METHODs and some other conveniences.</p>


<div class="pilwrap" id="request.defaults-options-">
  <h3>
    <a href="#request.defaults-options-" class="pilcrow">&#182;</a>
    request.defaults(options)
  </h3>
</div>


<p>This method returns a wrapper around the normal request API that defaults to whatever options you pass in to it.</p>


<div class="pilwrap" id="request.put">
  <h3>
    <a href="#request.put" class="pilcrow">&#182;</a>
    request.put
  </h3>
</div>


<p>Same as request() but defaults to <code>method: "PUT"</code>.</p>


<div class="highlight"><pre><code><span class="nx">request</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span>
</code></pre></div>




<div class="pilwrap" id="request.post">
  <h3>
    <a href="#request.post" class="pilcrow">&#182;</a>
    request.post
  </h3>
</div>


<p>Same as request() but defaults to <code>method: "POST"</code>.</p>


<div class="highlight"><pre><code><span class="nx">request</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span>
</code></pre></div>




<div class="pilwrap" id="request.head">
  <h3>
    <a href="#request.head" class="pilcrow">&#182;</a>
    request.head
  </h3>
</div>


<p>Same as request() but defaults to <code>method: "HEAD"</code>.</p>


<div class="highlight"><pre><code><span class="nx">request</span><span class="p">.</span><span class="nx">head</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span>
</code></pre></div>




<div class="pilwrap" id="request.del">
  <h3>
    <a href="#request.del" class="pilcrow">&#182;</a>
    request.del
  </h3>
</div>


<p>Same as request() but defaults to <code>method: "DELETE"</code>.</p>


<div class="highlight"><pre><code><span class="nx">request</span><span class="p">.</span><span class="nx">del</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span>
</code></pre></div>




<div class="pilwrap" id="request.get">
  <h3>
    <a href="#request.get" class="pilcrow">&#182;</a>
    request.get
  </h3>
</div>


<p>Alias to normal request method for uniformity.</p>


<div class="highlight"><pre><code><span class="nx">request</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span>
</code></pre></div>




<div class="pilwrap" id="request.cookie">
  <h3>
    <a href="#request.cookie" class="pilcrow">&#182;</a>
    request.cookie
  </h3>
</div>


<p>Function that creates a new cookie.</p>


<div class="highlight"><pre><code><span class="nx">request</span><span class="p">.</span><span class="nx">cookie</span><span class="p">(</span><span class="s1">&#39;cookie_string_here&#39;</span><span class="p">)</span>
</code></pre></div>




<div class="pilwrap" id="request.jar">
  <h3>
    <a href="#request.jar" class="pilcrow">&#182;</a>
    request.jar
  </h3>
</div>


<p>Function that creates a new cookie jar.</p>


<div class="highlight"><pre><code><span class="nx">request</span><span class="p">.</span><span class="nx">jar</span><span class="p">()</span>
</code></pre></div>




<div class="pilwrap" id="examples-">
  <h2>
    <a href="#examples-" class="pilcrow">&#182;</a>
    Examples:
  </h2>
</div>



<div class="highlight"><pre><code>  <span class="kd">var</span> <span class="nx">request</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;request&#39;</span><span class="p">)</span>
    <span class="p">,</span> <span class="nx">rand</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="o">*</span><span class="mi">100000000</span><span class="p">).</span><span class="nx">toString</span><span class="p">()</span>
    <span class="p">;</span>
  <span class="nx">request</span><span class="p">(</span>
    <span class="p">{</span> <span class="nx">method</span><span class="o">:</span> <span class="s1">&#39;PUT&#39;</span>
    <span class="p">,</span> <span class="nx">uri</span><span class="o">:</span> <span class="s1">&#39;http://mikeal.iriscouch.com/testjs/&#39;</span> <span class="o">+</span> <span class="nx">rand</span>
    <span class="p">,</span> <span class="nx">multipart</span><span class="o">:</span> 
      <span class="p">[</span> <span class="p">{</span> <span class="s1">&#39;content-type&#39;</span><span class="o">:</span> <span class="s1">&#39;application/json&#39;</span>
        <span class="p">,</span>  <span class="nx">body</span><span class="o">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span><span class="nx">foo</span><span class="o">:</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="nx">_attachments</span><span class="o">:</span> <span class="p">{</span><span class="s1">&#39;message.txt&#39;</span><span class="o">:</span> <span class="p">{</span><span class="nx">follows</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">length</span><span class="o">:</span> <span class="mi">18</span><span class="p">,</span> <span class="s1">&#39;content_type&#39;</span><span class="o">:</span> <span class="s1">&#39;text/plain&#39;</span> <span class="p">}}})</span>
        <span class="p">}</span>
      <span class="p">,</span> <span class="p">{</span> <span class="nx">body</span><span class="o">:</span> <span class="s1">&#39;I am an attachment&#39;</span> <span class="p">}</span>
      <span class="p">]</span> 
    <span class="p">}</span>
  <span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">response</span><span class="p">,</span> <span class="nx">body</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">statusCode</span> <span class="o">==</span> <span class="mi">201</span><span class="p">){</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;document saved as: http://mikeal.iriscouch.com/testjs/&#39;</span><span class="o">+</span> <span class="nx">rand</span><span class="p">)</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;error: &#39;</span><span class="o">+</span> <span class="nx">response</span><span class="p">.</span><span class="nx">statusCode</span><span class="p">)</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">body</span><span class="p">)</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">)</span>
</code></pre></div>



<p>Cookies are enabled by default (so they can be used in subsequent requests). To disable cookies set jar to false (either in defaults or in the options sent).</p>


<div class="highlight"><pre><code><span class="kd">var</span> <span class="nx">request</span> <span class="o">=</span> <span class="nx">request</span><span class="p">.</span><span class="nx">defaults</span><span class="p">({</span><span class="nx">jar</span><span class="o">:</span> <span class="kc">false</span><span class="p">})</span>
<span class="nx">request</span><span class="p">(</span><span class="s1">&#39;http://www.google.com&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="nx">request</span><span class="p">(</span><span class="s1">&#39;http://images.google.com&#39;</span><span class="p">)</span>
<span class="p">})</span>
</code></pre></div>



<p>If you to use a custom cookie jar (instead of letting request use its own global cookie jar) you do so by setting the jar default or by specifying it as an option:</p>


<div class="highlight"><pre><code><span class="kd">var</span> <span class="nx">j</span> <span class="o">=</span> <span class="nx">request</span><span class="p">.</span><span class="nx">jar</span><span class="p">()</span>
<span class="kd">var</span> <span class="nx">request</span> <span class="o">=</span> <span class="nx">request</span><span class="p">.</span><span class="nx">defaults</span><span class="p">({</span><span class="nx">jar</span><span class="o">:</span><span class="nx">j</span><span class="p">})</span>
<span class="nx">request</span><span class="p">(</span><span class="s1">&#39;http://www.google.com&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="nx">request</span><span class="p">(</span><span class="s1">&#39;http://images.google.com&#39;</span><span class="p">)</span>
<span class="p">})</span>
</code></pre></div>



<p>OR</p>


<div class="highlight"><pre><code><span class="kd">var</span> <span class="nx">j</span> <span class="o">=</span> <span class="nx">request</span><span class="p">.</span><span class="nx">jar</span><span class="p">()</span>
<span class="kd">var</span> <span class="nx">cookie</span> <span class="o">=</span> <span class="nx">request</span><span class="p">.</span><span class="nx">cookie</span><span class="p">(</span><span class="s1">&#39;your_cookie_here&#39;</span><span class="p">)</span>
<span class="nx">j</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">cookie</span><span class="p">)</span>
<span class="nx">request</span><span class="p">({</span><span class="nx">url</span><span class="o">:</span> <span class="s1">&#39;http://www.google.com&#39;</span><span class="p">,</span> <span class="nx">jar</span><span class="o">:</span> <span class="nx">j</span><span class="p">},</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="nx">request</span><span class="p">(</span><span class="s1">&#39;http://images.google.com&#39;</span><span class="p">)</span>
<span class="p">})</span>
</code></pre></div>

</div>
  </div>
</body>
</html>
