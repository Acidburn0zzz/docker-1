<!DOCTYPE html>
<html>
<head>
  <title>events.coffee</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../../../../doc-style.css" />
  <script src="../../../../../doc-filelist.js"></script>
  <script>
    var relativeDir = '../../../../../', thisFile = 'node_modules/watchr/node_modules/bal-util/test/events.coffee';
  </script>
  <script src="../../../../../doc-script.js"></script>
</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">
      <div class="heading h1">
        <a href="#-">#</a>
      </div>
      <div class="heading h1">
        <a href="#-">#</a>
      </div>
    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container"><div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
      <tr>
        <td class="docs">
          <h1>events.coffee</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1">&#182;</a>
</div>
<p>Requires</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="nv">assert = </span><span class="nx">require</span> <span class="s">&#39;assert&#39;</span>
<span class="nv">EventSystem = </span><span class="nx">require</span><span class="p">(</span><span class="nx">__dirname</span><span class="o">+</span><span class="s">&#39;/../lib/balutil.coffee&#39;</span><span class="p">).</span><span class="nx">EventSystem</span>
<span class="nv">debug = </span><span class="kc">false</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2">&#182;</a>
</div>
<p>=====================================
Configuration</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="k">class</span> <span class="nx">Person</span> <span class="k">extends</span> <span class="nx">EventSystem</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="-">
  <h1>
    <a href="#-" class="pilcrow">&#182;</a>
    #
  </h1>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>  <span class="nx">A</span> <span class="nx">person</span> <span class="nx">can</span> <span class="nx">eat</span> <span class="k">while</span> <span class="nx">they</span> <span class="nx">drink</span><span class="p">,</span> <span class="nx">but</span> <span class="nx">they</span> <span class="nx">can</span><span class="s">&#39;t drink while they eat</span>
<span class="s">  This has come from the fact that if you have food in your mouth, you can still drink things</span>
<span class="s">  Whereas if you have drink in your mouth, then put food in your mouth, the drink goes everywhere</span>

<span class="s">#----{DIVIDER_THING}----</span>


<span class="s">#----{DIVIDER_THING}----</span>
<span class="s">  eat: (something,next) -&gt;</span>
<span class="s">    console.log &quot;#{something}: started food&quot;  if debug</span>


<span class="s">#----{DIVIDER_THING}----</span>
<span class="s">    console.log &quot;#{something}: start eating&quot;  if debug</span>
<span class="s">    @start &#39;</span><span class="nx">eating</span><span class="s">&#39;, (err) =&gt;</span>

<span class="s">#----{DIVIDER_THING}----</span>
<span class="s">      console.log &quot;#{something}: eating&quot;  if debug</span>
<span class="s">      return next?(err)  if err</span>


<span class="s">#----{DIVIDER_THING}----</span>
<span class="s">      setTimeout(=&gt;</span>

<span class="s">#----{DIVIDER_THING}----</span>
<span class="s">        console.log &quot;#{something}: swallowed food&quot;  if debug</span>
<span class="s">      </span>

<span class="s">#----{DIVIDER_THING}----</span>
<span class="s">        next?(null,something)</span>


<span class="s">#----{DIVIDER_THING}----</span>
<span class="s">        console.log &quot;#{something}: start finish&quot;  if debug</span>
<span class="s">        @finished &#39;</span><span class="nx">eating</span><span class="s">&#39;, (err) -&gt;</span>

<span class="s">#----{DIVIDER_THING}----</span>
<span class="s">          console.log &quot;#{something}: finished food&quot;  if debug</span>
<span class="s">          return next?(err)  if err</span>

<span class="s">      ,2*1000)</span>
<span class="s">    </span>
<span class="s">  </span>

<span class="s">#----{DIVIDER_THING}----</span>
<span class="s">  drink: (something,next) -&gt;</span>
<span class="s">    console.log &quot;#{something}: started drink&quot;  if debug</span>


<span class="s">#----{DIVIDER_THING}----</span>
<span class="s">    console.log &quot;#{something}: blocking eating&quot;  if debug</span>
<span class="s">    @block &#39;</span><span class="nx">eating</span><span class="s">&#39;, (err) =&gt;</span>

<span class="s">#----{DIVIDER_THING}----</span>
<span class="s">      console.log &quot;#{something}: blocked eating&quot;  if debug</span>
<span class="s">      return next?(err)  if err</span>
<span class="s">        </span>

<span class="s">#----{DIVIDER_THING}----</span>
<span class="s">      console.log &quot;#{something}: start drinking&quot;  if debug</span>
<span class="s">      @start &#39;</span><span class="nx">drinking</span><span class="s">&#39;, (err) =&gt;</span>

<span class="s">#----{DIVIDER_THING}----</span>
<span class="s">        console.log &quot;#{something}: drinking&quot;  if debug</span>
<span class="s">        return next?(err)  if err</span>


<span class="s">#----{DIVIDER_THING}----</span>
<span class="s">        setTimeout(=&gt;</span>
<span class="s">          console.log &quot;#{something}: swallowed drink&quot;  if debug</span>


<span class="s">#----{DIVIDER_THING}----</span>
<span class="s">          next?(null,something)</span>
<span class="s">      </span>

<span class="s">#----{DIVIDER_THING}----</span>
<span class="s">          console.log &quot;#{something}: start finish&quot;  if debug</span>
<span class="s">          @finished &#39;</span><span class="nx">drinking</span><span class="s">&#39;, (err) =&gt;</span>

<span class="s">#----{DIVIDER_THING}----</span>
<span class="s">            console.log &quot;#{something}: finished drink&quot;  if debug</span>
<span class="s">            throw err  if err</span>
<span class="s">            </span>

<span class="s">#----{DIVIDER_THING}----</span>
<span class="s">            console.log &quot;#{something}: unblocking eating&quot;  if debug</span>
<span class="s">            @unblock &#39;</span><span class="nx">eating</span><span class="s">&#39;, (err) =&gt;</span>
<span class="s">              console.log &quot;#{something}: unblocked eating&quot;  if debug</span>
<span class="s">              throw err  if err</span>

<span class="s">        ,1*1000)</span>
<span class="s">    </span>


<span class="s">#----{DIVIDER_THING}----</span>

<span class="s">describe &#39;</span><span class="nx">EventSystem</span><span class="s">&#39;, -&gt;</span>

<span class="s">  it &#39;</span><span class="nx">should</span> <span class="nx">work</span> <span class="nx">as</span> <span class="nx">expected</span><span class="s">&#39;, (done) -&gt;</span>

<span class="s">#----{DIVIDER_THING}----</span>
<span class="s">    @timeout(15000)</span>
<span class="s">    foods = [&#39;</span><span class="nx">apple</span><span class="s">&#39;,&#39;</span><span class="nx">orange</span><span class="s">&#39;,&#39;</span><span class="nx">grape</span><span class="s">&#39;]</span>
<span class="s">    drinks = [&#39;</span><span class="nx">coke</span><span class="s">&#39;,&#39;</span><span class="nx">fanta</span><span class="s">&#39;,&#39;</span><span class="nx">water</span><span class="s">&#39;]</span>
<span class="s">    joe = new Person()</span>


<span class="s">#----{DIVIDER_THING}----</span>
<span class="s">    foodsAte = []</span>
<span class="s">    drinksDrunk = []</span>
<span class="s">    joeTriedToDrinkThenEat = false</span>


<span class="s">#----{DIVIDER_THING}----</span>
<span class="s">    eating = false</span>
<span class="s">    drinking = false</span>
<span class="s">    joe.on &#39;</span><span class="nx">eating</span><span class="o">:</span><span class="nx">locked</span><span class="s">&#39;, -&gt;</span>
<span class="s">      console.log &#39;</span><span class="nx">eating</span><span class="o">:</span><span class="nx">locked</span><span class="s">&#39;  if debug</span>
<span class="s">    joe.on &#39;</span><span class="nx">eating</span><span class="o">:</span><span class="nx">unlocked</span><span class="s">&#39;, -&gt;</span>
<span class="s">      console.log &#39;</span><span class="nx">eating</span><span class="o">:</span><span class="nx">unlocked</span><span class="s">&#39;  if debug</span>
<span class="s">    joe.on &#39;</span><span class="nx">eating</span><span class="o">:</span><span class="nx">started</span><span class="s">&#39;, -&gt;</span>
<span class="s">      console.log &#39;</span><span class="nx">eating</span><span class="o">:</span><span class="nx">started</span><span class="s">&#39;  if debug</span>
<span class="s">      if drinking is true</span>
<span class="s">        console.log &#39;</span><span class="nx">joe</span> <span class="nx">just</span> <span class="nx">tried</span> <span class="nx">to</span> <span class="nx">eat</span> <span class="k">then</span> <span class="nx">drink</span><span class="s">&#39;  if debug</span>
<span class="s">        joeTriedToDrinkThenEat = true</span>
<span class="s">      eating = true</span>
<span class="s">    joe.on &#39;</span><span class="nx">eating</span><span class="o">:</span><span class="nx">finished</span><span class="s">&#39;, -&gt;</span>
<span class="s">      console.log &#39;</span><span class="nx">eating</span><span class="o">:</span><span class="nx">finished</span><span class="s">&#39;  if debug</span>
<span class="s">      eating = false</span>
<span class="s">    </span>
<span class="s">    joe.on &#39;</span><span class="nx">drinking</span><span class="o">:</span><span class="nx">locked</span><span class="s">&#39;, -&gt;</span>
<span class="s">      console.log &#39;</span><span class="nx">drinking</span><span class="o">:</span><span class="nx">locked</span><span class="s">&#39;  if debug</span>
<span class="s">    joe.on &#39;</span><span class="nx">drinking</span><span class="o">:</span><span class="nx">unlocked</span><span class="s">&#39;, -&gt;</span>
<span class="s">      console.log &#39;</span><span class="nx">drinking</span><span class="o">:</span><span class="nx">unlocked</span><span class="s">&#39;  if debug</span>
<span class="s">    joe.on &#39;</span><span class="nx">drinking</span><span class="o">:</span><span class="nx">started</span><span class="s">&#39;, -&gt;</span>
<span class="s">      console.log &#39;</span><span class="nx">drinking</span><span class="o">:</span><span class="nx">started</span><span class="s">&#39;  if debug</span>
<span class="s">      drinking = true</span>
<span class="s">    joe.on &#39;</span><span class="nx">drinking</span><span class="o">:</span><span class="nx">finished</span><span class="s">&#39;, -&gt;</span>
<span class="s">      console.log &#39;</span><span class="nx">drinking</span><span class="o">:</span><span class="nx">finished</span><span class="s">&#39;  if debug</span>
<span class="s">      drinking = false</span>


<span class="s">#----{DIVIDER_THING}----</span>
<span class="s">    ateAFood = (err,something) -&gt;</span>
<span class="s">      throw err  if err</span>
<span class="s">      foodsAte.push something</span>
<span class="s">      console.log &quot;completely finished eating #{something} - #{foodsAte.length}/#{foods.length}&quot;  if debug</span>
<span class="s">    drankADrink = (err,something) -&gt;</span>
<span class="s">      throw err  if err</span>
<span class="s">      drinksDrunk.push something</span>
<span class="s">      console.log &quot;completely finished drinking #{something} - #{drinksDrunk.length}/#{drinks.length}&quot;  if debug</span>
<span class="s">    </span>

<span class="s">#----{DIVIDER_THING}----</span>
<span class="s">    joe.eat(food,ateAFood)  for food in foods</span>
<span class="s">    joe.drink(drink,drankADrink)  for drink in drinks</span>


<span class="s">#----{DIVIDER_THING}----</span>
<span class="s">    setTimeout(</span>
<span class="s">      -&gt;</span>
<span class="s">        assert.equal(foods.length, foodsAte.length, &#39;</span><span class="nx">joe</span> <span class="nx">ate</span> <span class="nx">all</span> <span class="nx">his</span> <span class="nx">foods</span><span class="s">&#39;)</span>
<span class="s">        assert.equal(drinks.length, drinksDrunk.length, &#39;</span><span class="nx">joe</span> <span class="nx">ate</span> <span class="nx">all</span> <span class="nx">his</span> <span class="nx">drinks</span><span class="s">&#39;)</span>
<span class="s">        assert.equal(false, joeTriedToDrinkThenEat, &#39;</span><span class="nx">joe</span> <span class="nx">tried</span> <span class="nx">to</span> <span class="nx">drink</span> <span class="k">then</span> <span class="nx">eat</span><span class="p">,</span> <span class="k">when</span> <span class="nx">he</span> <span class="nx">shouldn</span><span class="err">\</span><span class="s">&#39;t have&#39;</span><span class="p">)</span>
        <span class="nx">done</span><span class="p">()</span>
      <span class="p">,</span><span class="mi">14000</span>
    <span class="p">)</span>
</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="-">
  <h1>
    <a href="#-" class="pilcrow">&#182;</a>
    #
  </h1>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>undefined</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5">&#182;</a>
</div>
<p>Eat something</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>undefined</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6">&#182;</a>
</div>
<p>Start eating</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>undefined</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7">&#182;</a>
</div>
<p>Eating</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>undefined</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8">&#182;</a>
</div>
<p>Finish eating after 2 seconds</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>undefined</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9">&#182;</a>
</div>
<p>Finished eating</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>undefined</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10">&#182;</a>
</div>
<p>Perform our callback</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>undefined</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11">&#182;</a>
</div>
<p>Clean up</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>undefined</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-12" id="section-12">&#182;</a>
</div>
<p>Finished drinking</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>undefined</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-13" id="section-13">&#182;</a>
</div>
<p>Drink something</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>undefined</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-14" id="section-14">&#182;</a>
</div>
<p>Prevent eating</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>undefined</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-15" id="section-15">&#182;</a>
</div>
<p>Eating blocked</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>undefined</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-16" id="section-16">&#182;</a>
</div>
<p>Start drinking</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>undefined</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-17" id="section-17">&#182;</a>
</div>
<p>Drinking</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>undefined</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-18" id="section-18">&#182;</a>
</div>
<p>Finish drinking after 1 seconds</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>undefined</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-19" id="section-19">&#182;</a>
</div>
<p>Perform our callback</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>undefined</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-20" id="section-20">&#182;</a>
</div>
<p>Clean up</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>undefined</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-21" id="section-21">&#182;</a>
</div>
<p>Finished drinking</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>undefined</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-22" id="section-22">&#182;</a>
</div>
<p>Resume eating</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>undefined</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-23" id="section-23">&#182;</a>
</div>
<p>=====================================
Tests</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>undefined</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-24" id="section-24">&#182;</a>
</div>
<p>Prepare</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>undefined</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-25" id="section-25">&#182;</a>
</div>
<p>Completion handlers</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>undefined</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-26" id="section-26">&#182;</a>
</div>
<p>Track the order of what joe ate </p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>undefined</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-27" id="section-27">&#182;</a>
</div>
<p>Track what joe ate</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>undefined</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-28" id="section-28">&#182;</a>
</div>
<p>Stuff joe full of stuff</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>undefined</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-29" id="section-29">&#182;</a>
</div>
<p>Async</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>undefined</pre></div>
        </td>
      </tr>
  </tbody>
</table>
  </div>
</body>
</html>
